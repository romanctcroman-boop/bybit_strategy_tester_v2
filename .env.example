# Example environment configuration
# Copy this file to .env and adjust values as needed

# =========================================
# PRODUCTION SECURITY SETTINGS [UPDATE FOR PRODUCTION]
# =========================================

# --- CORS Configuration ---
# Comma-separated list of allowed origins
# [PRODUCTION] Replace with your actual frontend domains
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173,http://127.0.0.1:3000,http://127.0.0.1:5173
# Set to 'true' ONLY for development - allows all origins
# [PRODUCTION] Must be 'false'!
CORS_ALLOW_ALL=false

# --- Rate Limiting Configuration ---
# Enable/disable rate limiting (true in production)
RATE_LIMIT_ENABLED=true
# Default rate limits (requests per period in seconds)
RATE_LIMIT_DEFAULT_CALLS=100
RATE_LIMIT_DEFAULT_PERIOD=60
# AI Agent endpoints - more restrictive (expensive API calls)
RATE_LIMIT_AGENT_CALLS=30
RATE_LIMIT_AGENT_PERIOD=60
# Health/status endpoints - more permissive
RATE_LIMIT_HEALTH_CALLS=300
RATE_LIMIT_HEALTH_PERIOD=60
# Comma-separated IPs to whitelist from rate limiting
RATE_LIMIT_WHITELIST_IPS=

# --- Circuit Breaker Configuration ---
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_RECOVERY_TIMEOUT=60

# =========================================
# PERPLEXITY AI API CONFIGURATION
# =========================================
# Get your API key from: https://www.perplexity.ai/settings/api
PERPLEXITY_API_KEY=pplx-YOUR_API_KEY_HERE

# =========================================
# AGENT ROUTING OVERRIDES
# =========================================
# Set to 1 to bypass the MCP bridge entirely (default). Set to 0 to re-enable MCP.
FORCE_DIRECT_AGENT_API=1
# Set to 1 to mark the MCP bridge as decommissioned; all tools run in direct mode.
MCP_DISABLED=1

# =========================================
# BYBIT ADAPTER CONFIGURATION (NEW v2.0)
# =========================================

# API Configuration
BYBIT_API_BASE_URL=https://api.bybit.com
BYBIT_API_TIMEOUT=10
BYBIT_RATE_LIMIT_DELAY=0.2
BYBIT_MAX_REQUESTS_PER_BATCH=7

# Retry Configuration
BYBIT_RETRY_MAX_ATTEMPTS=3
BYBIT_RETRY_INITIAL_DELAY=1.0
BYBIT_RETRY_BACKOFF_FACTOR=2.0

# Cache Configuration
BYBIT_CACHE_ENABLED=true
BYBIT_CACHE_DIR=cache/bybit_klines
BYBIT_CACHE_TTL_DAYS=7
BYBIT_CACHE_MAX_CANDLES=2000

# Redis Cache Configuration (NEW)
BYBIT_REDIS_ENABLED=false
BYBIT_REDIS_HOST=localhost
BYBIT_REDIS_PORT=6379
BYBIT_REDIS_DB=0
BYBIT_REDIS_PASSWORD=

# Database Configuration
BYBIT_DB_PERSIST_ENABLED=true
BYBIT_PERSIST_KLINES=1
BYBIT_DB_BATCH_SIZE=1000

# API Keys (optional, only for private endpoints)
BYBIT_API_KEY=
BYBIT_API_SECRET=

# Logging Configuration
BYBIT_LOG_LEVEL=INFO
BYBIT_LOG_FILE=logs/bybit_adapter.log
BYBIT_LOG_JSON_FORMAT=false

# Monitoring & Metrics
BYBIT_ENABLE_METRICS=false
BYBIT_ENABLE_DETAILED_LOGGING=false

# =========================================
# DATABASE & REDIS CONFIGURATION
# =========================================

# Postgres connection (Docker default port)
DB_PORT=5432
DB_NAME=bybit
DB_USER=postgres
DB_PASS=postgres

# Full SQLAlchemy URL for backend
DATABASE_URL=postgresql://postgres:postgres@127.0.0.1:5432/bybit

# Redis settings (for /live websocket and pub/sub)
REDIS_URL=redis://127.0.0.1:6379/0
# Or use host/port/db if REDIS_URL is not set
# REDIS_HOST=127.0.0.1
# REDIS_PORT=6379
# REDIS_DB=0
# Redis channels/streams (optional overrides)
# REDIS_CHANNEL_TICKS=bybit:ticks
# REDIS_CHANNEL_KLINES=bybit:klines
# REDIS_STREAM_TICKS=stream:bybit:ticks
# REDIS_STREAM_KLINES=stream:bybit:klines
# WebSocket reconnect settings
# WS_RECONNECT_DELAY_SEC=1.5
# WS_RECONNECT_DELAY_MAX_SEC=15

# Bybit WebSocket manager (feature flag)
# Enable to auto-start WS background on FastAPI startup (1=enabled, 0=disabled)
BYBIT_WS_ENABLED=1
BYBIT_WS_SYMBOLS=BTCUSDT,ETHUSDT,SOLUSDT
BYBIT_WS_INTERVALS=1,5,15

# Alembic autogenerate target (optional)
# ALEMBIC_TARGET_METADATA=backend.models:Base

# Celery configuration (broker/worker)
# Default in dev/tests runs tasks inline (CELERY_EAGER=0 means off). For real workers, set a broker and backend.
# Common brokers: redis://localhost:6379/1 or amqp://guest:guest@localhost:5672//
# Common backend: redis://localhost:6379/2

# Eager mode executes tasks locally, synchronously (useful for tests)
# CELERY_EAGER=1

# Broker & result backend
# CELERY_BROKER_URL=redis://127.0.0.1:6379/1
# CELERY_RESULT_BACKEND=redis://127.0.0.1:6379/2

# Queues, flow control, reliability
# CELERY_TASK_DEFAULT_QUEUE=default
# CELERY_PREFETCH_MULTIPLIER=4
# CELERY_ACKS_LATE=1

# Retry policy (defaults are conservative)
# CELERY_TASK_DEFAULT_RETRY_DELAY=5
# CELERY_TASK_MAX_RETRIES=3

# Per-algorithm queues (optional overrides; default mapping is used if not set)
# CELERY_QUEUE_GRID=optimizations.grid
# CELERY_QUEUE_WALK=optimizations.walk
# CELERY_QUEUE_BAYES=optimizations.bayes

# -------------------------
# Docker Compose defaults
# -------------------------
# Используйте эти значения, если запускаете сервисы внутри docker-compose.
# Скопируйте .env.example в .env и раскомментируйте ниже для контейнеров.
#
# DATABASE_URL=postgresql://postgres:postgres@postgres:5432/bybit
# REDIS_URL=redis://redis:6379/0
# CELERY_BROKER_URL=redis://redis:6379/0
# CELERY_RESULT_BACKEND=redis://redis:6379/1
# CORS_ORIGINS=http://localhost:5173
# BYBIT_WS_ENABLED=0

# =========================================
# ALERTING CONFIGURATION (NEW)
# =========================================

# --- Slack Alerting ---
# Enable Slack notifications (set to 'true' to enable)
ALERT_SLACK_ENABLED=false
# Slack Webhook URL (create at https://api.slack.com/messaging/webhooks)
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL
# Default channel for alerts (can be overridden)
SLACK_ALERT_CHANNEL=#production-alerts
# Bot username shown in Slack
SLACK_USERNAME=Bybit Strategy Tester
# Bot emoji icon
SLACK_ICON_EMOJI=:robot_face:

# --- Email Alerting ---
# Enable Email notifications (set to 'true' to enable)
ALERT_EMAIL_ENABLED=false
# SMTP Server Configuration
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USE_TLS=true
# SMTP Credentials (for Gmail, use App Password, not regular password)
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-password
# From address (usually same as SMTP_USERNAME)
SMTP_FROM_EMAIL=your-email@gmail.com
# Comma-separated list of recipient emails
ALERT_EMAIL_TO=admin@example.com,ops@example.com

# --- Rate Limiting ---
# Minimum seconds between same alerts to prevent spam
ALERT_RATE_LIMIT_SECONDS=60

# =========================================
# DEEPSEEK AI API CONFIGURATION (MCP Server)
# =========================================
# Get your API key from: https://platform.deepseek.com/api-keys
# Cost: ~$0.14 per 1M input tokens, ~$0.28 per 1M output tokens (extremely cheap)

# Primary API Key (required for DeepSeek MCP server)
DEEPSEEK_API_KEY=sk-YOUR_DEEPSEEK_API_KEY_HERE

# Backup API Key (optional, for automatic failover)
DEEPSEEK_API_KEY_2=sk-YOUR_BACKUP_KEY_HERE

# Model Selection
# Options: deepseek-chat (general), deepseek-coder (code-optimized)
DEEPSEEK_MODEL=deepseek-chat

# Temperature (0.0-2.0, lower = more deterministic)
DEEPSEEK_TEMPERATURE=0.7
