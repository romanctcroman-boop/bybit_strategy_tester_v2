# ‚úÖ Strategy Builder - –£–ª—É—á—à–µ–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

> **–î–∞—Ç–∞**: 2026-01-29  
> **–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

---

## üìä –ß—Ç–æ —É–ª—É—á—à–µ–Ω–æ

### 1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è entry —Å–∏–≥–Ω–∞–ª–æ–≤ –∫ main strategy node

**–ü—Ä–æ–±–ª–µ–º–∞**: –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –±–µ–∑ entry —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–µ –º–æ–≥–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã.

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ `StrategyValidator._validate_structure()`:
- –ò—â–µ—Ç main strategy node (–±–ª–æ–∫ —Ç–∏–ø–∞ `OUTPUT_SIGNAL` —Å `isMain=True` –∏–ª–∏ –∏–º–µ–Ω–µ–º "strategy")
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∫ –ø–æ—Ä—Ç–∞–º `entry_long` –∏–ª–∏ `entry_short`
- –í—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É `NO_ENTRY_SIGNALS`, –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

**–ö–æ–¥**: `backend/services/strategy_builder/validator.py` (—Å—Ç—Ä–æ–∫–∏ 270-297)

---

### 2. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Ç–∏–ø–æ–≤ –ø–æ—Ä—Ç–æ–≤

**–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –í–∞–ª–∏–¥–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É outputs –∏ inputs:
- `series` ‚Üí `series` ‚úÖ
- `float` ‚Üí `series` ‚úÖ
- `bool` ‚Üí `signal` ‚úÖ
- `signal` ‚Üí `bool` ‚úÖ

**–ö–æ–¥**: `backend/services/strategy_builder/validator.py` (–º–µ—Ç–æ–¥ `_types_compatible`)

---

### 3. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –±–ª–æ–∫–æ–≤

**–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –∑–Ω–∞—á–µ–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
- `period`: 1-1000 (int)
- `fast_period`: 1-500 (int)
- `slow_period`: 2-1000 (int)
- `signal_period`: 1-100 (int)
- `std_dev`: 0.1-10.0 (float)
- –ò –¥—Ä—É–≥–∏–µ...

**–ö–æ–¥**: `backend/services/strategy_builder/validator.py` (–º–µ—Ç–æ–¥ `_validate_parameters`)

---

## üß™ –¢–µ—Å—Ç—ã

**–§–∞–π–ª**: `tests/backend/services/test_strategy_builder_validation.py`

**–ü–æ–∫—Ä—ã—Ç–∏–µ**:
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Å—Ç–æ–≥–æ –≥—Ä–∞—Ñ–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è entry —Å–∏–≥–Ω–∞–ª–æ–≤
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∞
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–¥–∏–∞–ø–∞–∑–æ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏–π)

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã**:
```
============================== 4 passed in 0.35s ==============================
```

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –±–µ–∑ entry —Å–∏–≥–Ω–∞–ª–æ–≤

```python
from backend.services.strategy_builder.validator import StrategyValidator

validator = StrategyValidator()
result = validator.validate(graph)

if not result.is_valid:
    for error in result.errors:
        if error.code == "NO_ENTRY_SIGNALS":
            print(f"–û—à–∏–±–∫–∞: {error.message}")
            print(f"–†–µ—à–µ–Ω–∏–µ: {error.suggestion}")
```

**–í—ã–≤–æ–¥**:
```
–û—à–∏–±–∫–∞: Main strategy node has no entry signals connected
–†–µ—à–µ–Ω–∏–µ: Connect at least one condition block to entry_long or entry_short port
```

---

### –ü—Ä–∏–º–µ—Ä 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ API

```python
# POST /api/v1/strategy-builder/validate/{strategy_id}?mode=backtest
response = {
    "is_valid": False,
    "errors": [
        {
            "code": "NO_ENTRY_SIGNALS",
            "message": "Main strategy node has no entry signals connected",
            "severity": "error",
            "block_id": "main_strategy",
            "suggestion": "Connect at least one condition block to entry_long or entry_short port"
        }
    ],
    "warnings": [],
    "block_count": 5,
    "connection_count": 3
}
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ main strategy node

–í–∞–ª–∏–¥–∞—Ç–æ—Ä –∏—â–µ—Ç –±–ª–æ–∫–∏ —Ç–∏–ø–∞ `OUTPUT_SIGNAL` —Å:
- `isMain=True` (–∞—Ç—Ä–∏–±—É—Ç –±–ª–æ–∫–∞)
- –ò–ª–∏ –∏–º–µ–Ω–µ–º "strategy" (case-insensitive)

–ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:
- –ï—Å–ª–∏ —É main node –µ—Å—Ç—å inputs `entry_long` –∏–ª–∏ `entry_short` ‚Üí —Ç—Ä–µ–±—É–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –Ω–∏–º
- –ò–Ω–∞—á–µ ‚Üí —Ç—Ä–µ–±—É–µ—Ç —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ main node

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∏–ø–æ–≤ –ø–æ—Ä—Ç–æ–≤

–í–∞–ª–∏–¥–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ç–∏–ø–æ–≤:
- `series` (pandas Series) ‚Üí `series` ‚úÖ
- `float` (—Å–∫–∞–ª—è—Ä) ‚Üí `series` ‚úÖ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)
- `bool` (boolean Series) ‚Üí `signal` ‚úÖ
- `signal` ‚Üí `bool` ‚úÖ

–ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Ç–∏–ø—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (–Ω–µ –æ—à–∏–±–∫—É), —Ç–∞–∫ –∫–∞–∫ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω—ã –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –ù–æ–≤—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ | 1 (entry signals) |
| –£–ª—É—á—à–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ | 2 (—Ç–∏–ø—ã –ø–æ—Ä—Ç–æ–≤, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã) |
| –¢–µ—Å—Ç–æ–≤ | 4 |
| –ü–æ–∫—Ä—ã—Ç–∏–µ | ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç |

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–∏–∫–ª–æ–≤** - —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ `_detect_cycles()`
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö inputs** - —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ `_validate_connections()`
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è live trading** - —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ `validate_for_live()`

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –±—ç–∫—Ç–µ—Å—Ç–∞
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ UI
- –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **COMPLETE**  
**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**: –î–∞
