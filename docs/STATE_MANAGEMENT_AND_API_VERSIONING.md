# State Management и API Versioning — рекомендации

**Дата:** 2026-01-31  
**Источник:** AUDIT_PROJECT_EXTENDED, рекомендации 7–8

---

## 1. State management (frontend)

### Текущее состояние
- Локальные переменные в модулях (strategy_builder.js, strategies.js и др.)
- Нет централизованного store (Redux/Vuex/Pinia)
- EventBus для части коммуникации

### Рекомендации
1. **Краткосрочно:** Использовать существующий EventBus для кросс-модульной синхронизации.
2. **Среднесрочно:** Ввести простой StateManager (паттерн observer) для Strategy Builder:
   - `strategyBlocks`, `connections`, `selectedBlockId` — единый источник истины
   - Подписка на изменения для перерисовки UI
3. **Долгосрочно:** При переходе на SPA — рассмотреть Pinia или Zustand.

---

## 2. API versioning

### Текущее состояние
- Префикс `/api/v1/` используется для большинства endpoints
- Версия v1 не задокументирована явно как контракт

### Рекомендации
1. **Зафиксировать:** Все публичные endpoints под `/api/v1/`.
2. **Документация:** В API_REFERENCE.md и OpenAPI — явно указать «API v1».
3. **План v2:** При breaking changes — вводить `/api/v2/`, сохранять v1 для обратной совместимости минимум 6 месяцев.
4. **Заголовок:** Опционально `X-API-Version: 1` для явного указания версии.

### План API v2 (при необходимости)

| Триггер | Действие |
|---------|----------|
| Breaking change в контракте | Добавить `/api/v2/` для новых endpoints |
| Deprecation v1 | Минимум 6 месяцев поддержки обеих версий |
| Миграция frontend | Поэтапно переводить вызовы на v2 |
| Удаление v1 | Только после подтверждения отсутствия клиентов |
