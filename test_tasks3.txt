============================= test session starts =============================
platform win32 -- Python 3.13.3, pytest-8.4.2, pluggy-1.6.0
rootdir: D:\bybit_strategy_tester_v2
configfile: pytest.ini
plugins: anyio-4.11.0, asyncio-1.2.0, cov-7.0.0, timeout-2.4.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 25 items

tests\backend\tasks\test_backtest_tasks.py ..................F......     [100%]

================================== FAILURES ===================================
______________ TestTaskChaining.test_bulk_backtest_creates_group ______________

args = (<test_backtest_tasks.TestTaskChaining object at 0x000001C50B390550>,)
keywargs = {}

    @wraps(func)
    def patched(*args, **keywargs):
>       with self.decoration_helper(patched,
                                    args,
                                    keywargs) as (newargs, newkeywargs):

C:\Users\roman\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1423: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
C:\Users\roman\AppData\Local\Programs\Python\Python313\Lib\contextlib.py:141: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
C:\Users\roman\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1405: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\roman\AppData\Local\Programs\Python\Python313\Lib\contextlib.py:530: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
C:\Users\roman\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1497: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x000001C50B325BF0>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'backend.tasks.backtest_tasks' from 'D:\\bybit_strategy_tester_v2\\backend\\tasks\\backtest_tasks.py'> does not have the attribute 'group'

C:\Users\roman\AppData\Local\Programs\Python\Python313\Lib\unittest\mock.py:1467: AttributeError
=============================== tests coverage ================================
_______________ coverage: platform win32, python 3.13.3-final-0 _______________

Name                                             Stmts   Miss Branch BrPart   Cover   Missing
---------------------------------------------------------------------------------------------
backend\agents\__init__.py                           2      2      0      0   0.00%   13-21
backend\agents\agent_background_service.py         173    173     26      0   0.00%   19-325
backend\agents\agent_to_agent_communicator.py      217    217     50      0   0.00%   7-627
backend\agents\deepseek.py                         334    334     64      0   0.00%   15-909
backend\agents\deepseek_cli.py                     188    188     36      0   0.00%   34-502
backend\agents\unified_agent_interface.py          207    207     34      0   0.00%   12-461
backend\api\__init__.py                              2      2      0      0   0.00%   5-7
backend\api\agent_to_agent_api.py                  241    241     44      0   0.00%   6-676
backend\api\app.py                                 205    205     10      0   0.00%   1-360
backend\api\circuit_breaker.py                     165    165     56      0   0.00%   10-455
backend\api\deepseek_client.py                      20     20      2      0   0.00%   6-37
backend\api\deepseek_pool.py                        80     80      8      0   0.00%   26-237
backend\api\error_handling.py                       95     95     28      0   0.00%   10-326
backend\api\lru_ttl_cache.py                       126    126     32      0   0.00%   16-350
backend\api\parallel_deepseek_client.py            137    137     20      0   0.00%   27-433
backend\api\parallel_deepseek_client_v2.py         244    244     68      0   0.00%   19-662
backend\api\perplexity_client.py                    74     74     12      0   0.00%   15-191
backend\api\routers\__init__.py                      3      3      0      0   0.00%   1-4
backend\api\routers\ab_testing.py                   69     69      0      0   0.00%   29-435
backend\api\routers\active_deals.py                 62     62      8      0   0.00%   1-115
backend\api\routers\admin.py                       304    304     52      0   0.00%   1-606
backend\api\routers\ai.py                           47     47      4      0   0.00%   6-150
backend\api\routers\analytics_ws.py                142    142     40      0   0.00%   15-540
backend\api\routers\anomaly_detection.py           210    210     18      0   0.00%   17-577
backend\api\routers\automl.py                      138    138      6      0   0.00%   14-565
backend\api\routers\backtests.py                   279    279    102      0   0.00%   1-698
backend\api\routers\backups.py                     141    141     20      0   0.00%   6-424
backend\api\routers\bots.py                         74     74     12      0   0.00%   1-130
backend\api\routers\cache.py                        61     61     10      0   0.00%   10-217
backend\api\routers\csv_export.py                   83     83     10      0   0.00%   10-244
backend\api\routers\dashboard.py                    15     15      0      0   0.00%   6-83
backend\api\routers\dashboard_metrics.py           118    118     16      0   0.00%   8-455
backend\api\routers\health.py                      114    114     14      0   0.00%   13-328
backend\api\routers\health_monitoring.py           175    175     42      0   0.00%   15-519
backend\api\routers\live.py                         76     76     24      0   0.00%   1-115
backend\api\routers\lstm_predictions.py            145    145     10      0   0.00%   14-478
backend\api\routers\marketdata.py                  348    348     76      0   0.00%   1-633
backend\api\routers\metrics.py                      39     39      4      0   0.00%   8-161
backend\api\routers\mock_backtests.py              583    583    194      0   0.00%   1-930
backend\api\routers\optimizations.py               170    170     44      0   0.00%   1-416
backend\api\routers\queue.py                       100    100     14      0   0.00%   10-323
backend\api\routers\reasoning.py                   165    165     18      0   0.00%   16-426
backend\api\routers\sandbox.py                     113    113      6      0   0.00%   13-361
backend\api\routers\security.py                     98     98     18      0   0.00%   6-307
backend\api\routers\strategies.py                   79     79     30      0   0.00%   1-121
backend\api\routers\strategy_templates.py           77     77     32      0   0.00%   16-429
backend\api\routers\test.py                         66     66      6      0   0.00%   6-185
backend\api\routers\tournament.py                  139    139     16      0   0.00%   8-469
backend\api\routers\wizard.py                       25     25      2      0   0.00%   1-88
backend\api\schemas.py                             360    360      8      0   0.00%   1-613
backend\api\secure_key_storage.py                  219    219     72      0   0.00%   17-704
backend\app.py                                      37     37      6      0   0.00%   6-108
backend\config.py                                   20     20      2      0   0.00%   11-71
backend\database\batch_writer.py                   118    118     24      0   0.00%   75-435
backend\database\pool_monitor.py                    88     88     22      0   0.00%   6-262
backend\health_checks.py                           131    131     24      0   0.00%   6-404
backend\indicators\rsi.py                           45     45     14      0   0.00%   6-119
backend\middleware\__init__.py                       2      2      0      0   0.00%   9-11
backend\middleware\cache_headers.py                 69     69     30      0   0.00%   18-259
backend\middleware\rate_limiter.py                 152    152     38      0   0.00%   6-382
backend\ml\__init__.py                              10     10      2      0   0.00%   10-50
backend\ml\drift_detector.py                        90     90     18      0   0.00%   15-376
backend\ml\lstm_queue_predictor.py                 345    345     76      0   0.00%   61-940
backend\ml\market_regime_detector.py               224    224     50      0   0.00%   8-502
backend\ml\model_manager.py                        188    188     32      0   0.00%   22-644
backend\ml\optimizer.py                            327    327     84      0   0.00%   7-711
backend\ml\optuna_optimizer.py                     178    178     52      0   0.00%   8-468
backend\ml\prompts.py                               27     27      2      0   0.00%   8-431
backend\ml\retrain_scheduler.py                    221    221     60      0   0.00%   24-685
backend\ml\retrain_scheduler_runner.py              98     98     24      0   0.00%   20-335
backend\models\saga_audit_log.py                    24     24      0      0   0.00%   12-161
backend\models\saga_checkpoint.py                   18     18      0      0   0.00%   11-122
backend\models\task.py                              30     30      0      0   0.00%   32-100
backend\optimization\__init__.py                     4      4      0      0   0.00%   10-20
backend\optimization\grid_optimizer.py             169    169     40      0   0.00%   16-413
backend\optimization\monte_carlo.py                122    122     42      0   0.00%   21-385
backend\optimization\monte_carlo_simulator.py       82     82     28      0   0.00%   25-290
backend\optimization\walk_forward.py               234    234     70      0   0.00%   23-598
backend\optimization\walk_forward_optimizer.py     153    153     30      0   0.00%   26-504
backend\orchestrator\__init__.py                     3      3      0      0   0.00%   5-22
backend\orchestrator\queue.py                      168    168     38      0   0.00%   17-466
backend\orchestrator\saga.py                       202    202     28      0   0.00%   18-477
backend\queue\__init__.py                            4      4      0      0   0.00%   7-11
backend\queue\adapter.py                            73     73      8      0   0.00%   8-277
backend\queue\autoscaler.py                        168    168     40      0   0.00%   7-358
backend\queue\redis_queue_manager.py               205    205     32      0   0.00%   6-412
backend\queue\task_handlers.py                      80     80     14      0   0.00%   5-237
backend\queue\worker_cli.py                         69     69     14      0   0.00%   5-145
backend\sandbox\__init__.py                          5      5      0      0   0.00%   6-11
backend\sandbox\docker_sandbox.py                   95     95     10      0   0.00%   6-300
backend\sandbox\resource_limiter.py                123    123     24      0   0.00%   5-280
backend\sandbox\sandbox_manager.py                 129    129     32      0   0.00%   6-351
backend\sandbox\security_validator.py              103    103     52      0   0.00%   6-273
backend\scaling\__init__.py                          5      5      0      0   0.00%   14-40
backend\scaling\celery_integration.py               76     76     12      0   0.00%   8-276
backend\scaling\dynamic_worker_scaling.py          175    175     46      0   0.00%   11-438
backend\scaling\health_checks.py                   202    202     52      0   0.00%   11-470
backend\scaling\load_balancer.py                   151    151     52      0   0.00%   11-372
backend\scaling\redis_consumer_groups.py           138    138     26      0   0.00%   11-457
backend\security\__init__.py                        10     10      0      0   0.00%   4-31
backend\security\ast_validator.py                  142    142     56      0   0.00%   21-497
backend\security\audit_logger.py                   121    121     36      0   0.00%   5-541
backend\security\auth_middleware.py                121    121     36      0   0.00%   6-372
backend\security\crypto.py                          48     48      8      0   0.00%   5-138
backend\security\jwt_manager.py                    170    170     28      0   0.00%   11-586
backend\security\key_manager.py                    116    116     40      0   0.00%   5-272
backend\security\key_rotation.py                   144    144     32      0   0.00%   5-341
backend\security\logging_middleware.py              47     47     12      0   0.00%   5-195
backend\security\master_key_manager.py              59     59     14      0   0.00%   5-157
backend\security\rate_limiter.py                   130    130     44      0   0.00%   6-344
backend\security\rbac_manager.py                   103    103     22      0   0.00%   6-410
backend\security\sandbox_executor.py               112    112     18      0   0.00%   6-361
backend\security\secure_logger.py                  131    131     36      0   0.00%   6-368
backend\security\secure_storage.py                 207    207     38      0   0.00%   5-358
backend\settings.py                                 96     96      4      0   0.00%   9-136
backend\strategies\sr_mean_reversion.py             60     60     18      0   0.00%   1-104
backend\strategies\sr_rsi_strategy.py               63     63     16      0   0.00%   16-291
backend\strategies\support_resistance.py            63     63     22      0   0.00%   1-92
backend\utils\__init__.py                            2      2      0      0   0.00%   7-21
backend\utils\formatting.py                         86     86     32      0   0.00%   11-393
backend\utils\password.py                           10     10      0      0   0.00%   3-36
backend\utils\serialization.py                      14     14      8      0   0.00%   8-75
backend\visualization\__init__.py                    2      2      0      0   0.00%   5-12
backend\visualization\advanced_charts.py            86     86     20      0   0.00%   12-431
backend\visualization\demo_charts.py               100    100     10      0   0.00%   12-240
backend\services\adapters\bybit.py                 526    495    156      0   4.55%   51, 67-115, 132-285, 307-398, 412-466, 471-566, 588-856, 860-885, 894-936, 947-965, 969-972, 976-979
backend\tasks\optimize_tasks.py                    236    216     50      0   6.99%   26-40, 44, 52-66, 99-276, 322-536, 582-745
backend\strategies\bollinger_mean_reversion.py     147    129     64      1   9.00%   46-80, 85, 95-115, 120-132, 173-194, 203-221, 239-284, 288-294, 304-310, 322-355, 359
backend\core\backtest_engine.py                    475    405    180      0  10.69%   35-37, 43-45, 62-65, 115-119, 133-206, 210-235, 239-260, 264-271, 283-299, 325-421, 433-475, 488-555, 566-591, 604-669, 682-683, 687-697, 701-857, 861, 909-1023, 1051-1101
backend\tasks\backfill_tasks.py                     82     69     12      0  13.83%   26-134, 145-150, 157-159
backend\core\cache.py                              152    125     34      0  14.52%   65-81, 85-103, 107, 112-123, 127-137, 151-175, 198-221, 225-235, 247-262, 266-289, 293-310, 324-341, 356-358
backend\core\logging_config.py                      52     41     22      0  14.86%   28-58, 75-129
backend\services\backfill_service.py               145    117     36      0  15.47%   22, 26, 43, 52-175, 185-196, 201-237, 241-246, 250-258
backend\services\data_service.py                   249    196     76      0  16.31%   50-51, 54, 57-58, 85-95, 99, 120-128, 136-144, 157-168, 180-186, 223-238, 242, 269-287, 296-307, 320-330, 344-392, 425-439, 443-449, 497-518, 530-533, 537, 554-559, 563, 567-569, 610-627, 631, 641-649, 653-663, 682-696, 700-703, 709-716, 720, 745-760, 772-775, 799-830, 834, 845-854, 862, 866, 870-871
backend\services\archival_service.py               110     87     24      0  17.16%   22-23, 37-38, 41-54, 59-95, 104-125, 131-185
backend\core\retry.py                               36     23      6      0  30.95%   38-93
backend\strategies\factory.py                       30     17      6      0  36.11%   41-55, 74-77, 91, 111-116
backend\core\metrics.py                             61     32      0      0  47.54%   123-157, 162-167, 176, 184-189, 198, 207, 216, 221, 236-251, 260-264
backend\database\__init__.py                        71     32     16      4  56.32%   27->37, 34-35, 51-52, 60-61, 74-76, 80, 103-149, 160-164
backend\core\exceptions.py                          29      9      2      0  64.52%   14-17, 122-128
backend\strategies\base.py                          10      3      0      0  70.00%   25-26, 88
backend\tasks\backtest_tasks.py                    175     26     50     16  80.44%   228->exit, 232->237, 238-239, 271->274, 292, 295, 302-315, 377->380, 381->384, 405->407, 407->412, 410-411, 423-424, 427->432, 430-431, 432->437, 435-436, 439->443, 449, 455-457, 463-469
backend\models\data_types.py                       203     21      8      0  86.26%   37-43, 99-103, 200-202, 245-250, 419-423
backend\core\engine_adapter.py                      18      1      2      1  90.00%   21->exit, 30
backend\core\config.py                              43      4      0      0  90.70%   75, 82, 102-103
backend\models\bybit_kline_audit.py                 22      1      0      0  95.45%   30
backend\api\routers\rbac.py                          0      0      0      0 100.00%
backend\indicators\__init__.py                       0      0      0      0 100.00%
backend\models\__init__.py                         114      0      0      0 100.00%
backend\models\backfill_progress.py                 11      0      0      0 100.00%
backend\models\backfill_run.py                      16      0      0      0 100.00%
backend\strategies\__init__.py                       4      0      0      0 100.00%
backend\tasks\__init__.py                            2      0      0      0 100.00%
---------------------------------------------------------------------------------------------
TOTAL                                            17989  17019   3962     22   4.62%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
Coverage JSON written to file coverage.json
=========================== short test summary info ===========================
FAILED tests/backend/tasks/test_backtest_tasks.py::TestTaskChaining::test_bulk_backtest_creates_group
======================== 1 failed, 24 passed in 15.97s ========================
