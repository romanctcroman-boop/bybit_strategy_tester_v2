---
description: Когда считать задачу сложной и как разбивать на атомарные подзадачи. Граф выполнения и карта переменных.
alwaysApply: true
---

# Автоматическая декомпозиция задач

## Триггеры: задача считается СЛОЖНОЙ

- Затрагивает **более 3 файлов**.
- Изменяет **более ~50 строк** кода.
- Вводит **новые зависимости** (import, пакеты).
- Требует изменения **API или публичных интерфейсов**.
- Затрагивает **бизнес-логику** (стратегии, движки, расчёт метрик).

При срабатывании любого из пунктов — сначала декомпозиция (см. task-decomposition.mdc), затем выполнение по подзадачам.

## Алгоритм декомпозиции

1. **Анализ масштаба**
   - **Grep** по ключевым терминам (имена функций, классов, констант).
   - **SemanticSearch** по концептуальному контексту (например: «где считается RSI для стратегии»).
   - **LS** по затронутым директориям для понимания структуры.

2. **Выделение атомарных операций**
   - Одна операция ≈ один модуль/класс/функция или одна связная правка.
   - Для каждой: входные данные, выходные данные, побочные эффекты (файлы, БД, API).

3. **Построение графа выполнения**

   ```
   ЗАДАЧА: [главная цель]
   ├── Подзадача 1: [атомарная операция]
   │   ├── Файл(ы): path/to/file.ext
   │   ├── Переменные: [var1, var2]
   │   ├── Зависимости: [dep1, dep2]
   │   └── Проверка: [как валидировать]
   ├── Подзадача 2: [зависит от 1]
   │   └── ...
   ```

4. **Отслеживание переменных**

   ```
   ПЕРЕМЕННАЯ: variable_name
   ├── Определена: file.py:123
   ├── Используется: file2.py:45, file3.py:67
   ├── Тип: str | int | object | …
   ├── Область: global | local | module
   └── Зависимые: [другие переменные/функции]
   ```

## Контрольные точки после подзадачи

- Синтаксис и импорты: `ruff check` по изменённым файлам.
- Поиск использования символа: **Grep** по имени переменной/функции (исключая `.git`, виртуальные окружения).
- При изменении API: проверить все вызовы через Grep/SemanticSearch.

## Специфика проекта (Bybit Strategy Tester)

- **Бэктест:** DataLoader → Strategy → BacktestEngine → Results — каждый компонент может быть отдельной подзадачей; после изменений — калибровка/сравнение при необходимости.
- **Параметры стратегий (Pine/конфиг):** индикаторы (RSI, ATR и т.д.) и условия входа/выхода — вести таблицу переменных и граф зависимостей.
- **Оптимизация:** периоды walk-forward и пространство параметров — явно перечислить переменные и связи с метриками.
