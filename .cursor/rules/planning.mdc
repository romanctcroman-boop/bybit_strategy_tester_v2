---
description: Когда запрашивать одобрение плана; сохранение планов в .cursor/plans/; исследование через LS/Grep/SemanticSearch.
alwaysApply: true
---

# Планирование и одобрение плана

## Триггер: задача требует плана и одобрения

- Затрагивает **более 2 файлов**.
- Изменяет **API или публичные интерфейсы**.
- Добавляет **новые зависимости** (пакеты, импорты модулей).
- **Рефакторинг** существующей логики.
- **Объём работы неочевиден** — нужен анализ перед действием.

## Процесс планирования

### Шаг 1: Исследование (обязательно)

- **LS** — структура затронутых директорий.
- **SemanticSearch** — концептуальный поиск (где используется X, как устроен Y).
- **Grep** — точный поиск имён функций, переменных, импортов.

### Шаг 2: План

- Разбить на подзадачи (см. task-decomposition.mdc, task-breakdown.mdc).
- Сохранить план в **.cursor/plans/** — файл `[краткое-имя-задачи].md` (латиница, без пробелов).
- В плане указать: затронутые файлы, переменные, зависимости, порядок выполнения, точки валидации.

### Шаг 3: Одобрение пользователя

Перед массовыми правками **запросить подтверждение**:

- «Создан план для задачи [название]. Затронуто файлов: N. Ключевые изменения: [список]. План: .cursor/plans/[файл].md. Начать выполнение? (да / изменить / отмена)»

### Шаг 4: Выполнение с отчётностью

- Выполнять по одной подзадаче; после каждой — валидация (линт, тесты).
- В плане помечать выполненные подзадачи (✅) и кратко фиксировать изменения (какие переменные затронуты).

## Шаблон плана (.cursor/plans/)

- **Анализ:** затронутые файлы, переменные, зависимости, риски.
- **Декомпозиция:** подзадача 1, 2, … (файл, действие, переменные, проверка).
- **Порядок выполнения** и **точки валидации** (ruff, pytest, и т.д.).

Подробный шаблон: `.cursor/commands/analyze-task.md`.
