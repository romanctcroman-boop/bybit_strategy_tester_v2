# Команда: безопасный рефакторинг с сохранением переменных

Использовать при рефакторинге нескольких файлов, переименованиях, переносе логики. Правила: `task-decomposition.mdc`, `trading-context.mdc`.

## ФАЗА 1: Снимок до рефакторинга

1. **Переменные:** Grep по затронутым файлам (определения и использования ключевых символов).
2. **Тесты:** `pytest tests/ -v` и сохранить результат (или зафиксировать, что все зелёные).
3. **Checkpoint:** `git add -A && git commit -m "CHECKPOINT: before refactor [краткое описание]"`.

## ФАЗА 2: План рефакторинга

- Что именно меняется (файлы, функции, классы).
- Какие переменные переименовываются/перемещаются.
- **Mapping:** старое_имя → новое_имя.
- Порядок изменений (по одной подзадаче).

**Запросить одобрение плана** перед выполнением.

## ФАЗА 3: Пошаговое выполнение

- Изменить один компонент (один файл или одну связную правку).
- Запустить тесты по затронутой области.
- Проверить, что переменные не потеряны (Grep по старым/новым именам).
- Commit после каждого шага (опционально).

## ФАЗА 4: Валидация после рефакторинга

- **Переменные:** сравнить использования до/после (Grep, ручная проверка).
- **Тесты:** `pytest tests/` — все должны проходить.
- **Линтер:** `ruff check` по изменённым файлам.
- **API:** при изменении публичного API — проверить вызовы (Grep по имени функции/класса).

## ФАЗА 5: Отчёт

- Что изменилось (файлы, mapping переменных).
- Результаты тестов и линтера.
- Потенциальные риски или TODO на будущее.

Обновить PROJECT_JOURNAL.md при значимом рефакторинге (решения, уроки).
