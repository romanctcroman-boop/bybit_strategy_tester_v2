<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Security headers should be set via HTTP server, not meta tags -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta name="referrer" content="strict-origin-when-cross-origin" />

    <title>Trading Strategies - Bybit Strategy Tester v2</title>
    <link rel="stylesheet" href="./css/strategies.css" />
      <script src="js/core/auto-event-binding.js"></script>
</head>
  <body>
    <div class="container">
      <header>
        <h1>üìä Trading Strategies</h1>
        <nav class="nav-links">
          <a href="dashboard.html">üè† Dashboard</a>
          <a href="streaming-chat.html">AI Chat</a>
          <a href="strategies.html" class="active">Strategies</a>
        </nav>
      </header>

      <div class="toolbar">
        <div class="search-box">
          <input
            type="text"
            id="searchInput"
            placeholder="Search strategies..."
          />
          <select id="statusFilter" title="Filter by status">
            <option value="">All Statuses</option>
            <option value="draft">Draft</option>
            <option value="active">Active</option>
            <option value="paused">Paused</option>
            <option value="archived">Archived</option>
          </select>
          <select id="typeFilter" title="Filter by strategy type">
            <option value="">All Types</option>
            <optgroup label="üìä –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã">
              <option value="sma_crossover">SMA Crossover</option>
              <option value="rsi">RSI</option>
              <option value="macd">MACD</option>
              <option value="bollinger_bands">Bollinger Bands</option>
            </optgroup>
            <optgroup label="üî∫ –ü–∏—Ä–∞–º–∏–¥–∏–Ω–≥">
              <option value="grid">Grid (–°–µ—Ç–∫–∞)</option>
              <option value="dca">DCA (–£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ)</option>
              <option value="martingale">Martingale</option>
            </optgroup>
          </select>
        </div>
        <button class="btn btn-primary" id="btnNewStrategy">
          + New Strategy
        </button>
      </div>

      <div id="strategiesContainer" class="strategies-grid">
        <div class="loading">
          <div class="spinner"></div>
          <p>Loading strategies...</p>
        </div>
      </div>
    </div>

    <!-- Create/Edit Modal -->
    <div class="modal-overlay" id="strategyModal">
      <div class="modal">
        <div class="modal-header">
          <h2 id="modalTitle">–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</h2>
          <button class="modal-close" id="btnCloseModal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="strategyForm">
            <input type="hidden" id="strategyId" />
            <div class="form-row">
              <div class="form-group">
                <label for="strategyName">–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ *</label>
                <input
                  type="text"
                  id="strategyName"
                  required
                  placeholder="–ú–æ—è SMA —Å—Ç—Ä–∞—Ç–µ–≥–∏—è"
                />
              </div>
              <div class="form-group">
                <label for="strategyMarketType">üìä –¢–∏–ø —Ä—ã–Ω–∫–∞</label>
                <select
                  id="strategyMarketType"
                  title="SPOT = –¥–∞–Ω–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã TradingView –¥–ª—è –ø–∞—Ä–∏—Ç–µ—Ç–∞ —Å–∏–≥–Ω–∞–ª–æ–≤. LINEAR = –ø–µ—Ä–ø–µ—Ç—É–∞–ª—å–Ω—ã–µ —Ñ—å—é—á–µ—Ä—Å—ã –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏."
                >
                  <option value="spot">üìä SPOT (TradingView Parity)</option>
                  <option value="linear" selected>
                    üìà Futures (LINEAR/Perpetual)
                  </option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="strategySymbol">–¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞</label>
                <div class="symbol-input-wrapper">
                  <input
                    type="text"
                    id="strategySymbol"
                    list="symbolsList"
                    placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Ç–∏–∫–µ—Ä"
                    autocomplete="off"
                  />
                  <datalist id="symbolsList"></datalist>
                  <span id="symbolStatus" class="symbol-status"></span>
                </div>
              </div>
              <div class="form-group">
                <label for="strategyTimeframe">–¢–∞–π–º—Ñ—Ä–µ–π–º</label>
                <select id="strategyTimeframe">
                  <option value="" selected disabled>-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
                  <option value="1">1m</option>
                  <option value="5">5m</option>
                  <option value="15">15m</option>
                  <option value="30">30m</option>
                  <option value="60">1h</option>
                  <option value="240">4h</option>
                  <option value="D">1D</option>
                  <option value="W">1W</option>
                  <option value="M">1M</option>
                </select>
              </div>
            </div>

            <!-- Data Status Indicator -->
            <div id="dataStatusRow" class="data-status-row hidden">
              <div id="dataStatusIndicator" class="data-status">
                <span class="status-icon">‚è≥</span>
                <span class="status-text">–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
              </div>
              <!-- Candle Loading Progress Bar -->
              <div
                id="candleLoadingProgress"
                class="candle-loading-progress hidden"
              >
                <div class="progress-header">
                  <span id="candleLoadingStatus">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–≤–µ—á–µ–π...</span>
                  <span id="candleLoadingPercent">0%</span>
                </div>
                <div class="progress-bar-container">
                  <div id="candleLoadingBar" class="progress-bar"></div>
                </div>
                <div class="progress-details" id="candleLoadingDetails">
                  –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...
                </div>
              </div>
            </div>

            <div class="form-row form-row-3">
              <div class="form-group">
                <label for="strategyCapital">–ù–∞—á–∞–ª—å–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª ($)</label>
                <input
                  type="number"
                  id="strategyCapital"
                  min="100"
                  step="100"
                  value="10000"
                />
              </div>
              <div class="form-group">
                <label for="strategyPositionSizeType">–¢–∏–ø —Ä–∞–∑–º–µ—Ä–∞ –æ—Ä–¥–µ—Ä–∞</label>
                <select
                  id="strategyPositionSizeType"
                  onchange="updatePositionSizeInput()"
                >
                  <option value="percent">% –æ—Ç –∫–∞–ø–∏—Ç–∞–ª–∞</option>
                  <option value="fixed_amount">–°—É–º–º–∞ –≤ $ (—Ñ–∏–∫—Å.)</option>
                  <option value="contracts">–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã/–õ–æ—Ç—ã</option>
                </select>
              </div>
              <div class="form-group">
                <label for="strategyPositionSize" id="positionSizeLabel"
                  >–†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ (%)</label
                >
                <input
                  type="number"
                  id="strategyPositionSize"
                  min="1"
                  max="100"
                  step="1"
                  value="100"
                />
              </div>
            </div>

            <div class="form-row form-row-1">
              <div class="form-group">
                <label for="strategyDirection">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</label>
                <select
                  id="strategyDirection"
                  title="–†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–ª–∏"
                >
                  <option value="both">Long &amp; Short</option>
                  <option value="long">–¢–æ–ª—å–∫–æ Long</option>
                  <option value="short">–¢–æ–ª—å–∫–æ Short</option>
                </select>
              </div>
            </div>

            <!-- Position Mode (only visible when direction=both) -->
            <div class="form-row" id="positionModeRow">
              <div class="form-group">
                <label for="strategyPositionMode"
                  >–†–µ–∂–∏–º –ø–æ–∑–∏—Ü–∏–π
                  <span class="param-hint">(–ø—Ä–∏ Long & Short)</span></label
                >
                <select
                  id="strategyPositionMode"
                  title="–ö–∞–∫ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏"
                >
                  <option value="block">üö´ Block (–Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –Ω–æ–≤—É—é)</option>
                  <option value="close_and_open">
                    üîÑ Close-and-Open (–∑–∞–∫—Ä—ã—Ç—å ‚Üí –æ—Ç–∫—Ä—ã—Ç—å)
                  </option>
                  <option value="hedge">
                    ‚öñÔ∏è Hedge Mode (–æ–±–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
                  </option>
                </select>
              </div>
              <div class="form-group">
                <label for="strategyEngineType"
                  >üöÄ –î–≤–∏–∂–æ–∫ –±—ç–∫—Ç–µ—Å—Ç–∞
                  <span class="param-hint">(—Å–∫–æ—Ä–æ—Å—Ç—å)</span></label
                >
                <select
                  id="strategyEngineType"
                  title="–í—ã–±–æ—Ä –¥–≤–∏–∂–∫–∞ –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏. –í—Å–µ –¥–≤–∏–∂–∫–∏ –¥–∞—é—Ç 100% –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–∫–æ—Ä–æ—Å—Ç—å."
                >
                  <option value="fallback" selected>
                    üîß Fallback (CPU) - —Å—Ç–∞–±–∏–ª—å–Ω—ã–π
                  </option>
                  <option value="numba">üî• Numba (JIT) - –±—ã—Å—Ç—Ä—ã–π</option>
                  <option value="gpu">
                    ‚ö° GPU (CUDA) - –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
                  </option>
                </select>
              </div>
            </div>

            <!-- Advanced Trading Parameters -->
            <div class="form-row form-row-3">
              <div class="form-group">
                <label for="strategyPyramiding">–ü–∏—Ä–∞–º–∏–¥–∏–Ω–≥</label>
                <input
                  type="number"
                  id="strategyPyramiding"
                  min="0"
                  max="100"
                  step="1"
                  value="1"
                  title="–ú–∞–∫—Å. –∫–æ–ª-–≤–æ –æ—Ä–¥–µ—Ä–æ–≤ –≤ –æ–¥–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ (1 = –±–µ–∑ —É—Å—Ä–µ–¥–Ω–µ–Ω–∏—è)"
                />
              </div>
              <div class="form-group">
                <label for="strategyCommission">–ö–æ–º–∏—Å—Å–∏—è (%)</label>
                <input
                  type="number"
                  id="strategyCommission"
                  min="0"
                  max="5"
                  step="0.01"
                  value="0.1"
                  title="–ö–æ–º–∏—Å—Å–∏—è –±–∏—Ä–∂–∏ –∑–∞ –∫–∞–∂–¥—É—é —Å–¥–µ–ª–∫—É (Bybit: 0.1%)"
                />
              </div>
              <div class="form-group">
                <label for="strategySlippage">–ü—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ (%)</label>
                <input
                  type="number"
                  id="strategySlippage"
                  min="0"
                  max="2"
                  step="0.01"
                  value="0.05"
                  title="–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ç –æ–∂–∏–¥–∞–µ–º–æ–π"
                />
              </div>
            </div>

            <div class="form-group leverage-group">
              <label for="strategyLeverage"
                >–ü–ª–µ—á–æ:
                <span id="leverageValue" class="leverage-value">1x</span></label
              >
              <input
                type="range"
                id="strategyLeverage"
                min="1"
                max="100"
                step="1"
                value="1"
                oninput="updateLeverageDisplay(this.value)"
                title="–ö—Ä–µ–¥–∏—Ç–Ω–æ–µ –ø–ª–µ—á–æ"
              />
              <div class="leverage-scale">
                <span>1x</span>
                <span>25x</span>
                <span>50x</span>
                <span>75x</span>
                <span>100x</span>
              </div>
              <div
                id="leverageRiskIndicator"
                class="leverage-risk-indicator"
              ></div>
              <div id="leverageWarning" class="leverage-warning"></div>
            </div>

            <!-- Advanced Simulation Settings (TradingView-like) -->
            <div class="form-section-divider">
              <span>–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏–º—É–ª—è—Ü–∏–∏</span>
            </div>

            <div class="form-row form-row-3">
              <div class="form-group">
                <label for="strategyBarMagnifier">Bar Magnifier</label>
                <select
                  id="strategyBarMagnifier"
                  title="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 1m –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–æ—á–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏ SL/TP –≤–Ω—É—Ç—Ä–∏ –±–∞—Ä–∞"
                >
                  <option value="false">–í—ã–∫–ª—é—á–µ–Ω</option>
                  <option value="true" selected>–í–∫–ª—é—á–µ–Ω (1m —Ç–∏–∫–∏)</option>
                </select>
              </div>
              <div class="form-group">
                <label for="strategyFillMode">–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤</label>
                <select
                  id="strategyFillMode"
                  title="–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª–Ω—è—é—Ç—Å—è –æ—Ä–¥–µ—Ä–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –±–∞—Ä–∞"
                >
                  <option value="bar_close">–ù–∞ –∑–∞–∫—Ä—ã—Ç–∏–∏ –±–∞—Ä–∞</option>
                  <option value="next_bar_open" selected>
                    –ù–∞ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å–ª–µ–¥. –±–∞—Ä–∞
                  </option>
                </select>
              </div>
              <div class="form-group">
                <label for="strategyMaxDrawdown">–õ–∏–º–∏—Ç –ø—Ä–æ—Å–∞–¥–∫–∏ (%)</label>
                <input
                  type="number"
                  id="strategyMaxDrawdown"
                  min="0"
                  max="100"
                  step="1"
                  value="0"
                  placeholder="0 = –±–µ–∑ –ª–∏–º–∏—Ç–∞"
                  title="–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ—Ä–≥–æ–≤–ª—é –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ø—Ä–æ—Å–∞–¥–∫–∏. 0 = –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π"
                />
              </div>
            </div>

            <!-- ============================================ -->
            <!-- COMMON TP/SL SETTINGS (for ALL strategy types) -->
            <!-- ============================================ -->

            <!-- Take-Profit Section -->
            <div class="common-tpsl-section" id="commonTpSlSection">
              <div class="dca-subsection">
                <h4 class="dca-subsection-title">üéØ –¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç</h4>
                <div class="form-row form-row-2">
                  <div class="form-group">
                    <label for="strategyTpMode"
                      >–†–µ–∂–∏–º TP
                      <span
                        class="param-hint"
                        title="–ü—Ä–æ—Å—Ç–æ–π: –æ–¥–∏–Ω –ª–∏–º–∏—Ç–Ω—ã–π —Ç–µ–π–∫. –°–≤–æ–π: —á–∞—Å—Ç–∏—á–Ω—ã–µ –≤—ã—Ö–æ–¥—ã –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö."
                        >‚ìò</span
                      >
                    </label>
                    <select id="strategyTpMode">
                      <option value="simple" selected>
                        –ü—Ä–æ—Å—Ç–æ–π (% –ø—Ä–æ—Ñ–∏—Ç–∞)
                      </option>
                      <option value="custom">–°–≤–æ–π (—á–∞—Å—Ç–∏—á–Ω—ã–µ –≤—ã—Ö–æ–¥—ã)</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="strategyTargetProfit"
                      >–¶–µ–ª–µ–≤–∞—è –ø—Ä–∏–±—ã–ª—å (%)
                      <span
                        class="param-hint"
                        title="% –ø—Ä–æ—Ñ–∏—Ç–∞ –æ—Ç —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã –≤—Ö–æ–¥–∞ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å–¥–µ–ª–∫–∏."
                        >‚ìò</span
                      >
                    </label>
                    <input
                      type="number"
                      id="strategyTargetProfit"
                      min="0.1"
                      max="100"
                      step="0.1"
                      value="1"
                      title="% —Ü–µ–ª–µ–≤–æ–≥–æ –ø—Ä–æ—Ñ–∏—Ç–∞"
                    />
                  </div>
                </div>
                <div class="form-row form-row-2">
                  <div class="form-group">
                    <label for="strategyTpTrailingEnabled"
                      >Trailing TP
                      <span
                        class="param-hint"
                        title="–ü–æ—Å–ª–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è TP –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —Ç—Ä–µ–π–ª–∏–Ω–≥-—Å—Ç–æ–ø, —Å–ª–µ–¥—É—é—â–∏–π –∑–∞ —Ü–µ–Ω–æ–π."
                        >‚ìò</span
                      >
                    </label>
                    <select id="strategyTpTrailingEnabled">
                      <option value="false">–í—ã–∫–ª</option>
                      <option value="true" selected>–í–∫–ª</option>
                    </select>
                  </div>
                  <div class="form-group" id="strategyTpTrailingPctGroup">
                    <label for="strategyTpTrailingPct"
                      >Trailing –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ (%)
                      <span
                        class="param-hint"
                        title="% –æ—Ç–∫–∞—Ç–∞ –æ—Ç –ø–∏–∫–∞ –¥–ª—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è —Ç—Ä–µ–π–ª–∏–Ω–≥–∞."
                        >‚ìò</span
                      >
                    </label>
                    <input
                      type="number"
                      id="strategyTpTrailingPct"
                      min="0.1"
                      max="20"
                      step="0.1"
                      value="0.5"
                      title="% –æ—Ç–∫–∞—Ç–∞ –æ—Ç –º–∞–∫—Å–∏–º—É–º–∞"
                    />
                  </div>
                </div>
              </div>

              <!-- Stop-Loss Section -->
              <div class="dca-subsection">
                <h4 class="dca-subsection-title">üõë –°—Ç–æ–ø-–ª–æ—Å—Å</h4>
                <div class="form-row form-row-2">
                  <div class="form-group">
                    <label for="strategySlEnabled"
                      >–°—Ç–æ–ø-–ª–æ—Å—Å
                      <span
                        class="param-hint"
                        title="–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —É–±—ã—Ç–∫–∞. –ü–µ—Ä–µ–¥ –≤–∫–ª—é—á–µ–Ω–∏–µ–º –∏–∑—É—á–∏—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ñ–∏—Ç–∏–ª–µ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞."
                        >‚ìò</span
                      >
                    </label>
                    <select id="strategySlEnabled">
                      <option value="false">–í—ã–∫–ª</option>
                      <option value="true" selected>–í–∫–ª</option>
                    </select>
                  </div>
                  <div class="form-group" id="strategySlPctGroup">
                    <label for="strategyStopLoss"
                      >–°—Ç–æ–ø-–ª–æ—Å—Å (%)
                      <span
                        class="param-hint"
                        title="% —É–±—ã—Ç–∫–∞ –æ—Ç —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏."
                        >‚ìò</span
                      >
                    </label>
                    <input
                      type="number"
                      id="strategyStopLoss"
                      min="0.1"
                      max="100"
                      step="0.1"
                      value="10"
                      title="% —Å—Ç–æ–ø-–ª–æ—Å—Å–∞"
                    />
                  </div>
                </div>
                <div class="form-row form-row-1" id="strategySlTypeGroup">
                  <div class="form-group">
                    <label for="strategyStopLossType"
                      >–¢–∏–ø —Å—Ç–æ–ø-–ª–æ—Å—Å–∞
                      <span
                        class="param-hint"
                        title="–û—Ç —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã: SL –æ—Ç —Å—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω–æ–π —Ü–µ–Ω—ã –≤—Ö–æ–¥–∞. –û—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ—Ä–¥–µ—Ä–∞: SL –æ—Ç —Ü–µ–Ω—ã –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –æ—Ä–¥–µ—Ä–∞."
                        >‚ìò</span
                      >
                    </label>
                    <select id="strategyStopLossType">
                      <option value="average" selected>–û—Ç —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã</option>
                      <option value="last_order">–û—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ—Ä–¥–µ—Ä–∞</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <!-- RSI Parameters Section -->
            <div
              id="rsiParametersSection"
              class="form-section indicator-section"
              style="display: none"
            >
              <div class="form-section-divider">
                <span>üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã RSI</span>
              </div>
              <div class="form-row form-row-3">
                <div class="form-group">
                  <label for="rsiPeriod"
                    >–ü–µ—Ä–∏–æ–¥ RSI
                    <span
                      class="param-hint"
                      title="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞—Ä–æ–≤ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ RSI. –°—Ç–∞–Ω–¥–∞—Ä—Ç: 14"
                      >‚ìò</span
                    >
                  </label>
                  <input
                    type="number"
                    id="rsiPeriod"
                    min="2"
                    max="100"
                    step="1"
                    value="14"
                    title="–ü–µ—Ä–∏–æ–¥ —Ä–∞—Å—á—ë—Ç–∞ RSI (2-100)"
                  />
                </div>
                <div class="form-group">
                  <label for="rsiOversold"
                    >–ü–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å
                    <span
                      class="param-hint"
                      title="–£—Ä–æ–≤–µ–Ω—å RSI –¥–ª—è —Å–∏–≥–Ω–∞–ª–∞ –Ω–∞ –ø–æ–∫—É–ø–∫—É (Long entry)"
                      >‚ìò</span
                    >
                  </label>
                  <input
                    type="number"
                    id="rsiOversold"
                    min="5"
                    max="50"
                    step="1"
                    value="30"
                    title="–£—Ä–æ–≤–µ–Ω—å –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç–∏ (5-50)"
                  />
                </div>
                <div class="form-group">
                  <label for="rsiOverbought"
                    >–ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å
                    <span
                      class="param-hint"
                      title="–£—Ä–æ–≤–µ–Ω—å RSI –¥–ª—è —Å–∏–≥–Ω–∞–ª–∞ –Ω–∞ –ø—Ä–æ–¥–∞–∂—É (Long exit / Short entry)"
                      >‚ìò</span
                    >
                  </label>
                  <input
                    type="number"
                    id="rsiOverbought"
                    min="50"
                    max="95"
                    step="1"
                    value="70"
                    title="–£—Ä–æ–≤–µ–Ω—å –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç–∏ (50-95)"
                  />
                </div>
              </div>
            </div>

            <!-- SMA Crossover Parameters Section -->
            <div
              id="smaParametersSection"
              class="form-section indicator-section"
              style="display: none"
            >
              <div class="form-section-divider">
                <span>üìà –ü–∞—Ä–∞–º–µ—Ç—Ä—ã SMA Crossover</span>
              </div>
              <div class="form-row form-row-2">
                <div class="form-group">
                  <label for="smaFastPeriod"
                    >–ë—ã—Å—Ç—Ä—ã–π SMA
                    <span
                      class="param-hint"
                      title="–ü–µ—Ä–∏–æ–¥ –±—ã—Å—Ç—Ä–æ–π —Å–∫–æ–ª—å–∑—è—â–µ–π —Å—Ä–µ–¥–Ω–µ–π"
                      >‚ìò</span
                    >
                  </label>
                  <input
                    type="number"
                    id="smaFastPeriod"
                    min="2"
                    max="100"
                    step="1"
                    value="10"
                    title="–ë—ã—Å—Ç—Ä—ã–π SMA –ø–µ—Ä–∏–æ–¥ (2-100)"
                  />
                </div>
                <div class="form-group">
                  <label for="smaSlowPeriod"
                    >–ú–µ–¥–ª–µ–Ω–Ω—ã–π SMA
                    <span
                      class="param-hint"
                      title="–ü–µ—Ä–∏–æ–¥ –º–µ–¥–ª–µ–Ω–Ω–æ–π —Å–∫–æ–ª—å–∑—è—â–µ–π —Å—Ä–µ–¥–Ω–µ–π (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ –±—ã—Å—Ç—Ä–æ–≥–æ)"
                      >‚ìò</span
                    >
                  </label>
                  <input
                    type="number"
                    id="smaSlowPeriod"
                    min="5"
                    max="200"
                    step="1"
                    value="30"
                    title="–ú–µ–¥–ª–µ–Ω–Ω—ã–π SMA –ø–µ—Ä–∏–æ–¥ (5-200)"
                  />
                </div>
              </div>
            </div>

            <!-- MACD Parameters Section -->
            <div
              id="macdParametersSection"
              class="form-section indicator-section"
              style="display: none"
            >
              <div class="form-section-divider">
                <span>üìâ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã MACD</span>
              </div>
              <div class="form-row form-row-3">
                <div class="form-group">
                  <label for="macdFastPeriod"
                    >–ë—ã—Å—Ç—Ä—ã–π EMA
                    <span
                      class="param-hint"
                      title="–ü–µ—Ä–∏–æ–¥ –±—ã—Å—Ç—Ä–æ–π EMA –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –ª–∏–Ω–∏–∏ MACD"
                      >‚ìò</span
                    >
                  </label>
                  <input
                    type="number"
                    id="macdFastPeriod"
                    min="2"
                    max="50"
                    step="1"
                    value="12"
                    title="–ë—ã—Å—Ç—Ä—ã–π EMA –ø–µ—Ä–∏–æ–¥ (2-50)"
                  />
                </div>
                <div class="form-group">
                  <label for="macdSlowPeriod"
                    >–ú–µ–¥–ª–µ–Ω–Ω—ã–π EMA
                    <span
                      class="param-hint"
                      title="–ü–µ—Ä–∏–æ–¥ –º–µ–¥–ª–µ–Ω–Ω–æ–π EMA –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –ª–∏–Ω–∏–∏ MACD"
                      >‚ìò</span
                    >
                  </label>
                  <input
                    type="number"
                    id="macdSlowPeriod"
                    min="10"
                    max="100"
                    step="1"
                    value="26"
                    title="–ú–µ–¥–ª–µ–Ω–Ω—ã–π EMA –ø–µ—Ä–∏–æ–¥ (10-100)"
                  />
                </div>
                <div class="form-group">
                  <label for="macdSignalPeriod"
                    >–°–∏–≥–Ω–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è
                    <span
                      class="param-hint"
                      title="–ü–µ—Ä–∏–æ–¥ —Å–∏–≥–Ω–∞–ª—å–Ω–æ–π –ª–∏–Ω–∏–∏ (EMA –æ—Ç MACD)"
                      >‚ìò</span
                    >
                  </label>
                  <input
                    type="number"
                    id="macdSignalPeriod"
                    min="2"
                    max="50"
                    step="1"
                    value="9"
                    title="–°–∏–≥–Ω–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ (2-50)"
                  />
                </div>
              </div>
            </div>

            <!-- Bollinger Bands Parameters Section -->
            <div
              id="bollingerParametersSection"
              class="form-section indicator-section"
              style="display: none"
            >
              <div class="form-section-divider">
                <span>üéØ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã Bollinger Bands</span>
              </div>
              <div class="form-row form-row-2">
                <div class="form-group">
                  <label for="bollingerPeriod"
                    >–ü–µ—Ä–∏–æ–¥
                    <span
                      class="param-hint"
                      title="–ü–µ—Ä–∏–æ–¥ —Å–∫–æ–ª—å–∑—è—â–µ–π —Å—Ä–µ–¥–Ω–µ–π –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –ª–∏–Ω–∏–∏"
                      >‚ìò</span
                    >
                  </label>
                  <input
                    type="number"
                    id="bollingerPeriod"
                    min="5"
                    max="100"
                    step="1"
                    value="20"
                    title="–ü–µ—Ä–∏–æ–¥ Bollinger (5-100)"
                  />
                </div>
                <div class="form-group">
                  <label for="bollingerStdDev"
                    >–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
                    <span
                      class="param-hint"
                      title="–ú–Ω–æ–∂–∏—Ç–µ–ª—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –¥–ª—è –≤–µ—Ä—Ö–Ω–µ–π/–Ω–∏–∂–Ω–µ–π –ø–æ–ª–æ—Å—ã"
                      >‚ìò</span
                    >
                  </label>
                  <input
                    type="number"
                    id="bollingerStdDev"
                    min="0.5"
                    max="5"
                    step="0.1"
                    value="2.0"
                    title="StdDev –º–Ω–æ–∂–∏—Ç–µ–ª—å (0.5-5)"
                  />
                </div>
              </div>
            </div>

            <!-- DCA/Grid Parameters Section (Veles-style) -->
            <div
              id="dcaParametersSection"
              class="form-section dca-section"
              style="display: none"
            >
              <div class="form-section-divider">
                <span>üî∫ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã DCA (Veles-—Å—Ç–∏–ª—å)</span>
              </div>

              <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö -->
              <div class="dca-subsection">
                <div class="dca-info-note">
                  <i class="bi bi-info-circle"></i>
                  <span
                    >–î–µ–ø–æ–∑–∏—Ç, –ø–ª–µ—á–æ –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ –æ–±—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
                    –≤—ã—à–µ</span
                  >
                </div>
              </div>

              <!-- –†–µ–∂–∏–º —Ç–æ—Ä–≥–æ–≤–ª–∏ -->
              <div class="dca-subsection">
                <h4 class="dca-subsection-title">üéõÔ∏è –†–µ–∂–∏–º —Ç–æ—Ä–≥–æ–≤–ª–∏</h4>
                <div class="form-row form-row-1">
                  <div class="form-group">
                    <label for="dcaTradingMode"
                      >–†–µ–∂–∏–º
                      <span
                        class="param-hint"
                        title="–ü—Ä–æ—Å—Ç–æ–π: DCA-—Å–µ—Ç–∫–∞ –ª–∏–º–∏—Ç–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤ —Å—Ç—Ä–æ–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –°–≤–æ–π: —Ä—É—á–Ω–∞—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è. –°–∏–≥–Ω–∞–ª: —Ä—ã–Ω–æ—á–Ω—ã–µ —É—Å—Ä–µ–¥–Ω–µ–Ω–∏—è –ø–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º."
                        >‚ìò</span
                      >
                    </label>
                    <select id="dcaTradingMode">
                      <option value="simple" selected>
                        –ü—Ä–æ—Å—Ç–æ–π (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–µ—Ç–∫–∞)
                      </option>
                      <option value="custom">
                        –°–≤–æ–π (—Ä—É—á–Ω–∞—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è)
                      </option>
                      <option value="signal">–°–∏–≥–Ω–∞–ª (–ø–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º)</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- –£—Å–ª–æ–≤–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–¥–µ–ª–∫–∏ -->
              <div class="dca-subsection">
                <h4 class="dca-subsection-title">üîç –£—Å–ª–æ–≤–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–¥–µ–ª–∫–∏</h4>
                <div class="form-row form-row-2">
                  <div class="form-group">
                    <label for="dcaEntryCondition"
                      >–§–∏–ª—å—Ç—Ä –≤—Ö–æ–¥–∞
                      <span
                        class="param-hint"
                        title="–í—ã–∫–ª ‚Äî –±–æ—Ç –≤—Ö–æ–¥–∏—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å–¥–µ–ª–∫–∏. –í–∫–ª ‚Äî –∂–¥—ë—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —É—Å–ª–æ–≤–∏–π (RSI –∏ –¥—Ä.)."
                        >‚ìò</span
                      >
                    </label>
                    <select id="dcaEntryCondition">
                      <option value="disabled">–í—ã–∫–ª (–≤—Ö–æ–¥ —Å—Ä–∞–∑—É)</option>
                      <option value="rsi" selected>RSI —Ñ–∏–ª—å—Ç—Ä</option>
                    </select>
                  </div>
                  <div class="form-group" id="dcaRsiTriggerGroup">
                    <label for="dcaRsiTrigger"
                      >RSI —Ç—Ä–∏–≥–≥–µ—Ä
                      <span
                        class="param-hint"
                        title="Long: –≤—Ö–æ–¥ –ø—Ä–∏ RSI –Ω–∏–∂–µ —ç—Ç–æ–≥–æ —É—Ä–æ–≤–Ω—è. Short: –≤—Ö–æ–¥ –ø—Ä–∏ RSI –≤—ã—à–µ 100 –º–∏–Ω—É—Å —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ."
                        >‚ìò</span
                      >
                    </label>
                    <input
                      type="number"
                      id="dcaRsiTrigger"
                      min="10"
                      max="90"
                      step="1"
                      value="30"
                      title="RSI —É—Ä–æ–≤–µ–Ω—å –¥–ª—è –≤—Ö–æ–¥–∞"
                    />
                  </div>
                </div>
                <div class="form-row form-row-2">
                  <div class="form-group">
                    <label for="dcaRsiPeriod">–ü–µ—Ä–∏–æ–¥ RSI</label>
                    <input
                      type="number"
                      id="dcaRsiPeriod"
                      min="2"
                      max="50"
                      step="1"
                      value="14"
                    />
                  </div>
                  <div class="form-group">
                    <label for="dcaMaxDeals"
                      >–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ N —Å–¥–µ–ª–æ–∫
                      <span
                        class="param-hint"
                        title="–£–∫–∞–∂–∏—Ç–µ –ª–∏–º–∏—Ç —Å–¥–µ–ª–æ–∫, –ø–æ—Å–ª–µ —á–µ–≥–æ –±–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è. 0 = –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π."
                        >‚ìò</span
                      >
                    </label>
                    <input
                      type="number"
                      id="dcaMaxDeals"
                      min="0"
                      max="1000"
                      step="1"
                      value="0"
                      title="0 = –±–µ–∑ –ª–∏–º–∏—Ç–∞"
                    />
                  </div>
                </div>
              </div>

              <!-- –°–µ—Ç–∫–∞ –æ—Ä–¥–µ—Ä–æ–≤ -->
              <div class="dca-subsection">
                <h4 class="dca-subsection-title">üìê –°–µ—Ç–∫–∞ –æ—Ä–¥–µ—Ä–æ–≤</h4>
                <div class="form-row form-row-2">
                  <div class="form-group">
                    <label for="dcaGridCoverage"
                      >–ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ (%)
                      <span
                        class="param-hint"
                        title="–ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã. –î–∏–∞–ø–∞–∑–æ–Ω –≤ % –º–µ–∂–¥—É –ø–µ—Ä–≤—ã–º –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–º –æ—Ä–¥–µ—Ä–æ–º –≤ —Å–µ—Ç–∫–µ. –í—ã–±–∏—Ä–∞–π—Ç–µ, –∏—Å—Ö–æ–¥—è –∏–∑ —Ç–∏–ø–∏—á–Ω–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞."
                        >‚ìò</span
                      >
                    </label>
                    <input
                      type="number"
                      id="dcaGridCoverage"
                      min="1"
                      max="99"
                      step="0.5"
                      value="10"
                      title="–î–∏–∞–ø–∞–∑–æ–Ω % –º–µ–∂–¥—É –ø–µ—Ä–≤—ã–º –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–º –æ—Ä–¥–µ—Ä–æ–º"
                    />
                  </div>
                  <div class="form-group">
                    <label for="dcaGridOrdersCount"
                      >–°–µ—Ç–∫–∞ –æ—Ä–¥–µ—Ä–æ–≤
                      <span
                        class="param-hint"
                        title="–ß–µ–º –±–æ–ª—å—à–µ –æ—Ä–¥–µ—Ä–æ–≤, —Ç–µ–º –º–µ–ª—å—á–µ –∫–∞–∂–¥—ã–π (–æ–±—ä—ë–º –¥–µ–ª–∏—Ç—Å—è –Ω–∞ –±–æ–ª—å—à–µ–µ —á–∏—Å–ª–æ —Ç–æ—á–µ–∫). –û—Ü–µ–Ω–∏—Ç–µ —Å–µ—Ç–∫—É –Ω–∞ –ø—Ä–µ–≤—å—é."
                        >‚ìò</span
                      >
                    </label>
                    <input
                      type="number"
                      id="dcaGridOrdersCount"
                      min="2"
                      max="60"
                      step="1"
                      value="10"
                      title="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ä–¥–µ—Ä–æ–≤ –≤ —Å–µ—Ç–∫–µ (2-60)"
                    />
                  </div>
                </div>
                <div class="form-row form-row-2">
                  <div class="form-group">
                    <label for="dcaMartingale"
                      >% –ú–∞—Ä—Ç–∏–Ω–≥–µ–π–ª–∞
                      <span
                        class="param-hint"
                        title="–í–æ —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Ä–∞—Å—Ç—ë—Ç –æ–±—ä—ë–º –∫–∞–∂–¥–æ–≥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ—Ä–¥–µ—Ä–∞. 100% = —Ä–∞–≤–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞. –ë–æ–ª—å—à–µ % ‚Äî –±—ã—Å—Ç—Ä–µ–µ –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –∫ —Ç–µ–∫—É—â–µ–π."
                        >‚ìò</span
                      >
                    </label>
                    <input
                      type="number"
                      id="dcaMartingale"
                      min="100"
                      max="500"
                      step="1"
                      value="105"
                      title="100% = —Ä–∞–≤–Ω—ã–µ, 150% = –∫–∞–∂–¥—ã–π +50%"
                    />
                  </div>
                  <div class="form-group">
                    <label for="dcaFirstOrderOffset"
                      >–û—Ç—Å—Ç—É–ø (%)
                      <span
                        class="param-hint"
                        title="Long: –ª–∏–º–∏—Ç –Ω–∏–∂–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã. Short: –ª–∏–º–∏—Ç –≤—ã—à–µ. 0 = –ú–∞—Ä–∫–µ—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º). –°–µ—Ç–∫–∞ —Å—Ç—Ä–æ–∏—Ç—Å—è –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –æ—Ä–¥–µ—Ä–∞."
                        >‚ìò</span
                      >
                    </label>
                    <input
                      type="number"
                      id="dcaFirstOrderOffset"
                      min="0"
                      max="10"
                      step="0.01"
                      value="0"
                      title="0 = –ú–∞—Ä–∫–µ—Ç, 0.01-10% = –ª–∏–º–∏—Ç"
                    />
                  </div>
                </div>
                <div class="form-row form-row-2">
                  <div class="form-group">
                    <label for="dcaLogDistribution"
                      >–õ–æ–≥. —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
                      <span
                        class="param-hint"
                        title="–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —à–∞–≥ –º–µ–∂–¥—É –æ—Ä–¥–µ—Ä–∞–º–∏. 1 = —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ. >1 = –ø–ª–æ—Ç–Ω–µ–µ —É —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã, —Ä–∞—Å—Ç—è–∂–µ–Ω–∏–µ –Ω–∞ –∫—Ä–∞—è—Ö."
                        >‚ìò</span
                      >
                    </label>
                    <input
                      type="number"
                      id="dcaLogDistribution"
                      min="0.1"
                      max="3"
                      step="0.1"
                      value="1"
                      title="1 = —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ, >1 = –ª–æ–≥–∞—Ä–∏—Ñ–º–∏—á–µ—Å–∫–æ–µ"
                    />
                  </div>
                  <div class="form-group">
                    <label for="dcaMaxActiveSO"
                      >–ß–∞—Å—Ç–∏—á–Ω–æ–µ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
                      <span
                        class="param-hint"
                        title="–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ —á–∏—Å–ª–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã—Å—Ç–∞–≤–ª—è–µ–º—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤. –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤ —Å—Ç–∞—Ç—É—Å–µ ¬´–û–∂–∏–¥–∞–µ—Ç¬ª –∏ –ø–æ–¥—Å—Ç–∞–≤—è—Ç—Å—è –ø–æ –º–µ—Ä–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è."
                        >‚ìò</span
                      >
                    </label>
                    <input
                      type="number"
                      id="dcaMaxActiveSO"
                      min="1"
                      max="10"
                      step="1"
                      value="3"
                      title="–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤ (1-10)"
                    />
                  </div>
                </div>
                <div class="form-row form-row-1">
                  <div class="form-group">
                    <label for="dcaGridTrailing"
                      >–ü–æ–¥—Ç—è–∂–∫–∞ —Å–µ—Ç–∫–∏ (%)
                      <span
                        class="param-hint"
                        title="–ï—Å–ª–∏ —Ü–µ–Ω–∞ —É—à–ª–∞ ¬´–Ω–µ —Ç—É–¥–∞¬ª, –±–æ—Ç –æ—Ç–º–µ–Ω–∏—Ç —Å–¥–µ–ª–∫—É –∏ –æ—Ä–¥–µ—Ä–∞ –∏ –∂–¥—ë—Ç –Ω–æ–≤—É—é —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞. –ü—Ä–∏ –û—Ç—Å—Ç—É–ø=0 (–ú–∞—Ä–∫–µ—Ç) –ø–æ–¥—Ç—è–∂–∫–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è."
                        >‚ìò</span
                      >
                    </label>
                    <input
                      type="number"
                      id="dcaGridTrailing"
                      min="0.1"
                      max="200"
                      step="0.1"
                      value="1"
                      title="% –ø–æ–¥—Ç—è–∂–∫–∏ (0.1-200%)"
                    />
                  </div>
                </div>
              </div>

              <!-- DCA Summary Preview -->
              <div class="dca-summary" id="dcaSummaryPreview">
                üìä –ü—Ä–µ–≤—å—é —Å–µ—Ç–∫–∏ –æ—Ä–¥–µ—Ä–æ–≤
              </div>
              <div class="dca-so-preview" id="dcaSoLevelsPreview">
                <!-- Will be filled by JavaScript -->
              </div>
            </div>

            <div class="form-row form-row-strategy-meta">
              <div class="form-group">
                <label for="strategyType">–¢–∏–ø —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ *</label>
                <select id="strategyType" required>
                  <optgroup label="üìä –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã">
                    <option value="sma_crossover">SMA Crossover</option>
                    <option value="rsi">RSI</option>
                    <option value="macd">MACD</option>
                    <option value="bollinger_bands">Bollinger Bands</option>
                    <option value="bollinger_rsi">Bollinger + RSI</option>
                  </optgroup>
                  <optgroup label="üî∫ –ü–∏—Ä–∞–º–∏–¥–∏–Ω–≥">
                    <option value="dca">üìÖ DCA (–£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ / –°–µ—Ç–∫–∞)</option>
                  </optgroup>
                  <optgroup label="–î—Ä—É–≥–æ–µ">
                    <option value="custom">Custom</option>
                  </optgroup>
                </select>
              </div>
              <div class="form-group">
                <label for="strategyStatus">–°—Ç–∞—Ç—É—Å</label>
                <select id="strategyStatus">
                  <option value="draft">–ß–µ—Ä–Ω–æ–≤–∏–∫</option>
                  <option value="active">–ê–∫—Ç–∏–≤–Ω–∞</option>
                  <option value="paused">–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</option>
                </select>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="btnCancelModal">–û—Ç–º–µ–Ω–∞</button>
          <button class="btn btn-primary" id="btnSaveStrategy">
            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
          </button>
        </div>
      </div>
    </div>

    <!-- Backtest Modal -->
    <div class="modal-overlay" id="backtestModal">
      <div class="modal">
        <div class="modal-header">
          <h2>–ó–∞–ø—É—Å–∫ –±—ç–∫—Ç–µ—Å—Ç–∞</h2>
          <button class="modal-close" id="btnCloseBacktestModal">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="backtestForm">
            <input type="hidden" id="backtestStrategyId" />

            <!-- Strategy Info Display -->
            <div id="backtestStrategyInfo" class="backtest-strategy-info">
              <!-- Will be populated by JavaScript -->
            </div>

            <!-- Quick Period Buttons -->
            <div class="form-group">
              <label>–ü–µ—Ä–∏–æ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</label>
              <div class="period-buttons">
                <button
                  type="button"
                  class="btn btn-outline period-btn"
                  data-period="1d"
                >
                  24 —á–∞—Å–∞
                </button>
                <button
                  type="button"
                  class="btn btn-outline period-btn"
                  data-period="1w"
                >
                  –ù–µ–¥–µ–ª—è
                </button>
                <button
                  type="button"
                  class="btn btn-outline period-btn"
                  data-period="1m"
                >
                  –ú–µ—Å—è—Ü
                </button>
                <button
                  type="button"
                  class="btn btn-outline period-btn"
                  data-period="3m"
                >
                  3 –º–µ—Å—è—Ü–∞
                </button>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="backtestStartDate">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
                <input type="date" id="backtestStartDate" required />
              </div>
              <div class="form-group">
                <label for="backtestEndDate">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                <input type="date" id="backtestEndDate" required />
              </div>
            </div>

            <div class="form-group">
              <label>
                <input type="checkbox" id="backtestSaveResult" checked />
                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –æ–±–Ω–æ–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
              </label>
            </div>

            <!-- Engine Selection - REMOVED: Use engine from strategy settings instead -->
            <!-- Bar Magnifier Settings -->
            <div class="form-section bar-magnifier-section">
              <div class="section-header">
                <h4 class="section-title">
                  üîç Bar Magnifier (Precise Intrabar)
                </h4>
                <label class="toggle-switch">
                  <input
                    type="checkbox"
                    id="useBarMagnifier"
                    title="–í–∫–ª—é—á–∏—Ç—å Bar Magnifier –¥–ª—è —Ç–æ—á–Ω–æ–π –≤–Ω—É—Ç—Ä–∏–±–∞—Ä–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏"
                    checked
                  />
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div id="barMagnifierOptions" class="bar-magnifier-options">
                <p class="section-description">
                  –ò—Å–ø–æ–ª—å–∑—É–µ—Ç 1-–º–∏–Ω—É—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞
                  —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è SL/TP –≤–Ω—É—Ç—Ä–∏ –±–∞—Ä–∞.
                </p>
                <div class="form-row">
                  <div class="form-group">
                    <label for="intrabarOhlcPath">OHLC Path Model</label>
                    <select
                      id="intrabarOhlcPath"
                      title="–ü–æ—Ä—è–¥–æ–∫ –æ–±—Ö–æ–¥–∞ —Ü–µ–Ω –≤–Ω—É—Ç—Ä–∏ 1m —Å–≤–µ—á–∏"
                    >
                      <option value="O-HL-heuristic" selected>
                        O-HL-heuristic (TradingView)
                      </option>
                      <option value="O-H-L-C">
                        O-H-L-C (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –¥–ª—è Short)
                      </option>
                      <option value="O-L-H-C">
                        O-L-H-C (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –¥–ª—è Long)
                      </option>
                      <option value="conservative_long">
                        Conservative Long
                      </option>
                      <option value="conservative_short">
                        Conservative Short
                      </option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="intrabarSubticks">Subticks</label>
                    <select
                      id="intrabarSubticks"
                      title="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ç–æ—á–µ–∫ –º–µ–∂–¥—É OHLC"
                    >
                      <option value="0">0 (—Ç–æ–ª—å–∫–æ OHLC)</option>
                      <option value="1" selected>1 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</option>
                      <option value="2">2</option>
                      <option value="5">5</option>
                    </select>
                  </div>
                </div>
                <div class="bar-magnifier-info">
                  <small
                    >üìä –î–ª—è 1h –±–∞—Ä–∞: 60 √ó (4 + subticks√ó3) =
                    <span id="ticksPerBar">420</span> —Ç–∏–∫–æ–≤</small
                  >
                </div>
              </div>
            </div>

            <!-- Enable Optimization Toggle -->
            <div class="form-section optimization-toggle-section">
              <div class="section-header">
                <h4 class="section-title">‚öôÔ∏è –†–µ–∂–∏–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h4>
              </div>
              <div class="optimization-mode-selector">
                <label class="mode-option">
                  <input
                    type="radio"
                    name="testingMode"
                    id="modeSimpleBacktest"
                    value="backtest"
                    checked
                  />
                  <span class="mode-card">
                    <span class="mode-icon">‚ñ∂Ô∏è</span>
                    <span class="mode-title">–ü—Ä–æ—Å—Ç–æ–π –±—ç–∫—Ç–µ—Å—Ç</span>
                    <span class="mode-desc"
                      >–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</span
                    >
                  </span>
                </label>
                <label class="mode-option">
                  <input
                    type="radio"
                    name="testingMode"
                    id="modeOptimization"
                    value="optimization"
                  />
                  <span class="mode-card">
                    <span class="mode-icon">üîç</span>
                    <span class="mode-title">–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è</span>
                    <span class="mode-desc"
                      >Grid Search –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span
                    >
                  </span>
                </label>
              </div>
            </div>

            <!-- Optimization Section -->
            <div class="optimization-section" id="optimizationSection">
              <div class="optimization-header">
                <h3 class="optimization-title">üîç –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</h3>
              </div>

              <div id="optimizationParams" class="optimization-params">
                <div class="optimization-info">
                  <small id="optimizationInfoText"
                    >Grid Search –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–±–µ—Ä–µ—Ç –ª—É—á—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                    —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</small
                  >
                </div>

                <!-- Dynamic strategy parameters will be generated here -->
                <div id="dynamicStrategyParams">
                  <!-- Filled by JavaScript based on strategy type -->
                </div>

                <!-- TP/SL Optimization Section -->
                <div class="optimization-tpsl-section">
                  <h4 class="section-subtitle">üìä Stop Loss / Take Profit</h4>

                  <div class="form-row optimization-row">
                    <div class="form-group">
                      <label
                        >Stop Loss %
                        <span class="param-hint"
                          >(1-50%, —Å—Ç–æ–ø-–ª–æ—Å—Å)</span
                        ></label
                      >
                      <div class="range-inputs">
                        <div class="input-with-label">
                          <span class="input-label">–æ—Ç</span>
                          <input
                            type="number"
                            id="optStopLossMin"
                            value="5"
                            min="1"
                            max="50"
                            step="0.5"
                            title="–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π Stop Loss %"
                          />
                        </div>
                        <span class="range-separator">‚Äî</span>
                        <div class="input-with-label">
                          <span class="input-label">–¥–æ</span>
                          <input
                            type="number"
                            id="optStopLossMax"
                            value="15"
                            min="1"
                            max="50"
                            step="0.5"
                            title="–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π Stop Loss %"
                          />
                        </div>
                        <div class="input-with-label">
                          <span class="input-label">—à–∞–≥</span>
                          <input
                            type="number"
                            id="optStopLossStep"
                            value="5"
                            min="0.5"
                            max="10"
                            step="0.5"
                            title="–®–∞–≥ –∏–∑–º–µ–Ω–µ–Ω–∏—è Stop Loss"
                          />
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="form-row optimization-row">
                    <div class="form-group">
                      <label
                        >Take Profit %
                        <span class="param-hint"
                          >(0.5-20%, —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç)</span
                        ></label
                      >
                      <div class="range-inputs">
                        <div class="input-with-label">
                          <span class="input-label">–æ—Ç</span>
                          <input
                            type="number"
                            id="optTakeProfitMin"
                            value="1"
                            min="0.5"
                            max="20"
                            step="0.5"
                            title="–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π Take Profit %"
                          />
                        </div>
                        <span class="range-separator">‚Äî</span>
                        <div class="input-with-label">
                          <span class="input-label">–¥–æ</span>
                          <input
                            type="number"
                            id="optTakeProfitMax"
                            value="3"
                            min="0.5"
                            max="20"
                            step="0.5"
                            title="–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π Take Profit %"
                          />
                        </div>
                        <div class="input-with-label">
                          <span class="input-label">—à–∞–≥</span>
                          <input
                            type="number"
                            id="optTakeProfitStep"
                            value="1"
                            min="0.5"
                            max="5"
                            step="0.5"
                            title="–®–∞–≥ –∏–∑–º–µ–Ω–µ–Ω–∏—è Take Profit"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ç–±–æ—Ä–∞ –ª—É—á—à–µ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ -->
                <div class="form-section selection-criteria-section">
                  <h4 class="section-subtitle">
                    üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ç–±–æ—Ä–∞ –ª—É—á—à–µ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
                  </h4>
                  <p class="section-description">
                    –í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è. –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ ‚Äî
                    —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª—É—á—à–µ–π –ø–æ –≤—Å–µ–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º.
                  </p>

                  <div class="criteria-grid">
                    <label
                      class="criteria-item"
                      title="–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å/—É–±—ã—Ç–æ–∫. –ß–µ–º –±–æ–ª—å—à–µ ‚Äî —Ç–µ–º –ª—É—á—à–µ."
                    >
                      <input
                        type="checkbox"
                        id="criteriaNetProfit"
                        name="selectionCriteria"
                        value="net_profit"
                        checked
                      />
                      <span class="criteria-icon">üí∞</span>
                      <span class="criteria-name">Total P&L</span>
                      <span class="criteria-direction positive"
                        >‚Üë –±–æ–ª—å—à–µ = –ª—É—á—à–µ</span
                      >
                    </label>

                    <label
                      class="criteria-item"
                      title="–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞ –∫–∞–ø–∏—Ç–∞–ª–∞. –ß–µ–º –º–µ–Ω—å—à–µ ‚Äî —Ç–µ–º –ª—É—á—à–µ."
                    >
                      <input
                        type="checkbox"
                        id="criteriaMaxDrawdown"
                        name="selectionCriteria"
                        value="max_drawdown"
                        checked
                      />
                      <span class="criteria-icon">üìâ</span>
                      <span class="criteria-name">Max Equity Drawdown</span>
                      <span class="criteria-direction negative"
                        >‚Üì –º–µ–Ω—å—à–µ = –ª—É—á—à–µ</span
                      >
                    </label>
                  </div>

                  <div id="criteriaWarning" class="criteria-warning hidden">
                    ‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫—Ä–∏—Ç–µ—Ä–∏–π
                  </div>
                </div>

                <!-- –ú–µ—Ç–æ–¥ –ø–æ–∏—Å–∫–∞ -->
                <div class="form-section search-method-section">
                  <h4 class="section-subtitle">üîç –ú–µ—Ç–æ–¥ –ø–æ–∏—Å–∫–∞</h4>
                  <div class="form-row">
                    <div class="form-group">
                      <select
                        id="searchMethod"
                        title="–ú–µ—Ç–æ–¥ –ø–æ–∏—Å–∫–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤"
                      >
                        <option value="grid" selected>
                          üìä Grid Search ‚Äî –≤—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
                        </option>
                        <option value="random">
                          üé≤ Random Search ‚Äî —Å–ª—É—á–∞–π–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞
                        </option>
                      </select>
                    </div>
                    <div
                      class="form-group"
                      id="maxIterationsGroup"
                      style="display: none"
                    >
                      <label for="maxIterations">–ú–∞–∫—Å. –∏—Ç–µ—Ä–∞—Ü–∏–π</label>
                      <input
                        type="number"
                        id="maxIterations"
                        value="200"
                        min="10"
                        max="10000"
                        step="10"
                        title="–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª—É—á–∞–π–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π"
                      />
                    </div>
                  </div>
                  <p class="section-description" id="searchMethodHint">
                    Grid Search –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏. Random Search –±—ã—Å—Ç—Ä–µ–µ
                    –Ω–∞—Ö–æ–¥–∏—Ç —Ö–æ—Ä–æ—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∏ –±–æ–ª—å—à–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –ø–æ–∏—Å–∫–∞.
                  </p>
                </div>

                <!-- Market Regime Filter (P1) -->
                <div class="form-section market-regime-section">
                  <h4 class="section-subtitle">üìä –†–µ–∂–∏–º —Ä—ã–Ω–∫–∞</h4>
                  <div class="form-row">
                    <div class="form-group">
                      <label class="checkbox-label">
                        <input type="checkbox" id="marketRegimeEnabled" title="–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Å–¥–µ–ª–∫–∏ –ø–æ —Ä–µ–∂–∏–º—É —Ä—ã–Ω–∫–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç FallbackV4)" />
                        –§–∏–ª—å—Ç—Ä –ø–æ —Ä–µ–∂–∏–º—É
                      </label>
                    </div>
                    <div class="form-group">
                      <label for="marketRegimeFilter">–†–µ–∂–∏–º</label>
                      <select id="marketRegimeFilter" title="–†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ —Ä–µ–∂–∏–º—ã">
                        <option value="all">–í—Å–µ</option>
                        <option value="trending">–¢—Ä–µ–Ω–¥</option>
                        <option value="ranging">–ë–æ–∫–æ–≤–∏–∫</option>
                        <option value="not_volatile" selected>–ù–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ</option>
                        <option value="volatile">–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="marketRegimeLookback">–û–∫–Ω–æ</label>
                      <input type="number" id="marketRegimeLookback" value="50" min="10" max="200" step="5" title="–û–∫–Ω–æ —Ä–∞—Å—á—ë—Ç–∞ —Ä–µ–∂–∏–º–∞ (–±–∞—Ä—ã)" />
                    </div>
                  </div>
                  <p class="section-description">
                    –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è FallbackV4 (–º–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ —Ç–æ—á–Ω–µ–µ).
                  </p>
                </div>

                <div class="optimization-summary" id="optimizationSummary">
                  <span
                    >–ë—É–¥–µ—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:
                    <strong id="totalCombinations">0</strong> –∫–æ–º–±–∏–Ω–∞—Ü–∏–π</span
                  >
                  <span class="time-estimate" id="timeEstimate"></span>
                </div>
              </div>
            </div>

            <!-- Progress Section (hidden by default) -->
            <div id="backtestProgress" class="backtest-progress hidden">
              <div class="progress-header">
                <span id="backtestStatusText">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</span>
                <span id="backtestPercentText">0%</span>
              </div>

              <!-- Main progress bar -->
              <div class="progress-bar-container main-progress">
                <div id="backtestProgressBar" class="progress-bar"></div>
              </div>

              <!-- Multi-thread Worker Progress Bars -->
              <div class="worker-progress-bars" id="workerProgressBars">
                <div class="worker-bar-row" data-worker="0">
                  <span class="worker-label">W1</span>
                  <div class="worker-bar-container">
                    <div class="worker-bar" id="workerBar0"></div>
                  </div>
                </div>
                <div class="worker-bar-row" data-worker="1">
                  <span class="worker-label">W2</span>
                  <div class="worker-bar-container">
                    <div class="worker-bar" id="workerBar1"></div>
                  </div>
                </div>
                <div class="worker-bar-row" data-worker="2">
                  <span class="worker-label">W3</span>
                  <div class="worker-bar-container">
                    <div class="worker-bar" id="workerBar2"></div>
                  </div>
                </div>
                <div class="worker-bar-row" data-worker="3">
                  <span class="worker-label">W4</span>
                  <div class="worker-bar-container">
                    <div class="worker-bar" id="workerBar3"></div>
                  </div>
                </div>
              </div>

              <div class="progress-details" id="backtestProgressDetails">
                –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö...
              </div>

              <!-- Real-time stats -->
              <div class="progress-stats">
                <span id="progressSpeed"></span>
                <span id="progressEta"></span>
              </div>
            </div>

            <!-- Results Section (hidden by default) -->
            <div id="backtestResults" class="backtest-results hidden">
              <h3 class="results-title">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—ç–∫—Ç–µ—Å—Ç–∞</h3>
              <div class="results-grid">
                <div class="result-card">
                  <span class="result-label">–î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å</span>
                  <span class="result-value" id="resultReturn">-</span>
                </div>
                <div class="result-card">
                  <span class="result-label">Sharpe Ratio</span>
                  <span class="result-value" id="resultSharpe">-</span>
                </div>
                <div class="result-card">
                  <span class="result-label">Win Rate</span>
                  <span class="result-value" id="resultWinRate">-</span>
                </div>
                <div class="result-card">
                  <span class="result-label">Max Drawdown</span>
                  <span class="result-value" id="resultDrawdown">-</span>
                </div>
                <div class="result-card">
                  <span class="result-label">–°–¥–µ–ª–æ–∫</span>
                  <span class="result-value" id="resultTrades">-</span>
                </div>
                <div class="result-card">
                  <span class="result-label">Profit Factor</span>
                  <span class="result-value" id="resultProfitFactor">-</span>
                </div>
              </div>
              <div class="results-footer">
                <span class="result-period" id="resultPeriod"></span>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="btnCancelBacktest">
            –û—Ç–º–µ–Ω–∞
          </button>
          <button
            class="btn btn-outline"
            id="btnResetOptParams"
            title="–°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"
          >
            üîÑ –°–±—Ä–æ—Å–∏—Ç—å
          </button>
          <button class="btn btn-primary" id="btnRunOptimization">
            <span id="btnRunOptimizationText">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é</span>
            <span id="btnRunOptimizationSpinner" class="spinner hidden"></span>
          </button>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Search Method Toggle Script -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const searchMethod = document.getElementById("searchMethod");
        const maxIterGroup = document.getElementById("maxIterationsGroup");

        if (searchMethod && maxIterGroup) {
          searchMethod.addEventListener("change", function () {
            maxIterGroup.style.display =
              this.value === "random" ? "block" : "none";
          });
        }

        // ========================================
        // DCA/Grid Parameters Section Toggle
        // ========================================
        const strategyType = document.getElementById("strategyType");
        const dcaSection = document.getElementById("dcaParametersSection");
        const dcaLogarithmic = document.getElementById("dcaLogarithmic");
        const dcaLogCoefficientGroup = document.getElementById(
          "dcaLogCoefficientGroup",
        );
        const pyramidingInput = document.getElementById("strategyPyramiding");

        const pyramidingStrategies = ["dca"];

        function updateDcaSectionVisibility() {
          if (!dcaSection || !strategyType) return;

          const isPyramiding = pyramidingStrategies.includes(
            strategyType.value,
          );
          dcaSection.style.display = isPyramiding ? "block" : "none";

          // –ê–≤—Ç–æ-—É—Å—Ç–∞–Ω–æ–≤–∫–∞ pyramiding –¥–ª—è DCA —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
          if (pyramidingInput && isPyramiding) {
            const gridOrders = document.getElementById("dcaGridOrders");
            if (
              gridOrders &&
              parseInt(pyramidingInput.value) < parseInt(gridOrders.value)
            ) {
              pyramidingInput.value = gridOrders.value;
            }
          }
        }

        function updateLogCoefficientVisibility() {
          if (!dcaLogCoefficientGroup || !dcaLogarithmic) return;
          dcaLogCoefficientGroup.style.display = dcaLogarithmic.checked
            ? "block"
            : "none";
        }

        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è pyramiding —Å —Å–µ—Ç–∫–æ–π –æ—Ä–¥–µ—Ä–æ–≤
        function syncPyramidingWithGrid() {
          const gridOrders = document.getElementById("dcaGridOrders");
          if (
            gridOrders &&
            pyramidingInput &&
            pyramidingStrategies.includes(strategyType?.value)
          ) {
            pyramidingInput.value = gridOrders.value;
          }
        }

        if (strategyType) {
          strategyType.addEventListener("change", updateDcaSectionVisibility);
        }

        if (dcaLogarithmic) {
          dcaLogarithmic.addEventListener(
            "change",
            updateLogCoefficientVisibility,
          );
        }

        const dcaGridOrders = document.getElementById("dcaGridOrders");
        if (dcaGridOrders) {
          dcaGridOrders.addEventListener("change", syncPyramidingWithGrid);
        }

        // ========================================
        // Offset Type Toggle (Market / Limit)
        // ========================================
        const dcaOffsetType = document.getElementById("dcaOffsetType");
        const dcaOffsetInput = document.getElementById("dcaOffset");

        function updateOffsetInputState() {
          if (!dcaOffsetType || !dcaOffsetInput) return;
          const isMarket = dcaOffsetType.value === "market";
          dcaOffsetInput.disabled = isMarket;
          if (isMarket) {
            dcaOffsetInput.value = "0";
          } else {
            if (parseFloat(dcaOffsetInput.value) < 0.01) {
              dcaOffsetInput.value = "0.1";
            }
          }
        }

        if (dcaOffsetType) {
          dcaOffsetType.addEventListener("change", updateOffsetInputState);
        }

        // ========================================
        // Testing Mode Toggle (Backtest vs Optimization)
        // ========================================
        const modeBacktest = document.getElementById("modeSimpleBacktest");
        const modeOptimization = document.getElementById("modeOptimization");
        const optimizationSection = document.getElementById(
          "optimizationSection",
        );
        const btnRunOptimization =
          document.getElementById("btnRunOptimization");
        const btnRunOptimizationText = document.getElementById(
          "btnRunOptimizationText",
        );

        function updateTestingModeUI() {
          const isBacktestMode = modeBacktest?.checked;

          // Show/hide optimization parameters section
          if (optimizationSection) {
            if (isBacktestMode) {
              optimizationSection.classList.add("collapsed");
            } else {
              optimizationSection.classList.remove("collapsed");
            }
          }

          // Update button text
          if (btnRunOptimizationText) {
            if (isBacktestMode) {
              btnRunOptimizationText.textContent = "‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –±—ç–∫—Ç–µ—Å—Ç";
            } else {
              btnRunOptimizationText.textContent = "üîç –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é";
            }
          }
        }

        if (modeBacktest) {
          modeBacktest.addEventListener("change", updateTestingModeUI);
        }
        if (modeOptimization) {
          modeOptimization.addEventListener("change", updateTestingModeUI);
        }

        // Initial state
        updateDcaSectionVisibility();
        updateLogCoefficientVisibility();
        updateOffsetInputState();
        updateTestingModeUI();
      });
    </script>

    <script type="module" src="./js/pages/strategies.js?v=20260120"></script>
  </body>
</html>
