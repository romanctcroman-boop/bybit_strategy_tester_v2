<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net https://unpkg.com; style-src 'self' https://cdn.jsdelivr.net https://fonts.googleapis.com 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' https://cdn.jsdelivr.net https://fonts.gstatic.com; connect-src 'self' https://api.bybit.com wss://stream.bybit.com ws://localhost:* http://localhost:*; frame-src 'none'; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors 'none'">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta name="referrer" content="strict-origin-when-cross-origin">

    <title>Advanced Analytics - Bybit Strategy Tester v2</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/frontend/css/analytics_advanced.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="top-nav">
        <a href="dashboard.html" class="nav-brand">
            <i class="fas fa-chart-line"></i>
            Bybit Strategy Tester v2
        </a>
        <div class="nav-links">
            <a href="dashboard.html" class="nav-link">Dashboard</a>
            <a href="trading.html" class="nav-link">Trading</a>
            <a href="strategies.html" class="nav-link">Strategies</a>
            <a href="analytics.html" class="nav-link">Analytics</a>
            <a href="analytics-advanced.html" class="nav-link active">Advanced</a>
            <a href="portfolio.html" class="nav-link">Portfolio</a>
            <a href="risk-management.html" class="nav-link">Risk</a>
        </div>
        <div class="nav-actions">
            <button class="btn-icon" title="Refresh Data" aria-label="Refresh data">
                <i class="fas fa-sync-alt"></i>
            </button>
            <button class="btn-icon" title="Export Report" aria-label="Export report">
                <i class="fas fa-download"></i>
            </button>
            <button class="btn-icon" title="Settings" aria-label="Settings">
                <i class="fas fa-cog"></i>
            </button>
        </div>
    </nav>

    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="page-title">
                <h1><i class="fas fa-chart-bar"></i> Advanced Analytics</h1>
                <span class="badge">Pro</span>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary">
                    <i class="fas fa-calendar"></i>
                    Last 30 Days
                </button>
                <button class="btn btn-secondary">
                    <i class="fas fa-filter"></i>
                    Filters
                </button>
                <button class="btn btn-primary">
                    <i class="fas fa-file-pdf"></i>
                    Export PDF
                </button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs" role="tablist">
            <button class="tab active" role="tab" aria-selected="true">Overview</button>
            <button class="tab" role="tab" aria-selected="false">Performance</button>
            <button class="tab" role="tab" aria-selected="false">Risk Analysis</button>
            <button class="tab" role="tab" aria-selected="false">Correlations</button>
            <button class="tab" role="tab" aria-selected="false">Backtests</button>
        </div>

        <!-- Performance Summary -->
        <div class="performance-summary">
            <div class="summary-card">
                <h4>Total Return</h4>
                <div class="summary-value positive">+47.82%</div>
                <div class="summary-change positive">
                    <i class="fas fa-arrow-up"></i>
                    +12.4% vs last month
                </div>
            </div>
            <div class="summary-card">
                <h4>Sharpe Ratio</h4>
                <div class="summary-value neutral">2.34</div>
                <div class="summary-change positive">
                    <i class="fas fa-arrow-up"></i>
                    +0.18 improvement
                </div>
            </div>
            <div class="summary-card">
                <h4>Max Drawdown</h4>
                <div class="summary-value negative">-8.42%</div>
                <div class="summary-change positive">
                    <i class="fas fa-arrow-up"></i>
                    Recovered in 12 days
                </div>
            </div>
            <div class="summary-card">
                <h4>Win Rate</h4>
                <div class="summary-value positive">68.5%</div>
                <div class="summary-change positive">
                    <i class="fas fa-arrow-up"></i>
                    +3.2% vs average
                </div>
            </div>
            <div class="summary-card">
                <h4>Profit Factor</h4>
                <div class="summary-value positive">2.87</div>
                <div class="summary-change neutral">
                    <i class="fas fa-minus"></i>
                    Stable
                </div>
            </div>
            <div class="summary-card">
                <h4>Total Trades</h4>
                <div class="summary-value neutral">1,847</div>
                <div class="summary-change positive">
                    <i class="fas fa-arrow-up"></i>
                    +234 this month
                </div>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="charts-grid">
            <div class="chart-card">
                <div class="chart-header">
                    <h3><i class="fas fa-chart-area"></i> Equity Curve</h3>
                    <div class="chart-controls">
                        <button class="chart-btn active">1M</button>
                        <button class="chart-btn">3M</button>
                        <button class="chart-btn">6M</button>
                        <button class="chart-btn">1Y</button>
                        <button class="chart-btn">All</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="equityCurveChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <div class="chart-header">
                    <h3><i class="fas fa-pie-chart"></i> Returns Distribution</h3>
                </div>
                <div class="chart-container">
                    <canvas id="returnsDistChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Technical Indicators -->
        <h3 class="section-title">Technical Indicators</h3>
        <div class="indicators-grid">
            <div class="indicator-card">
                <div class="indicator-header">
                    <span class="indicator-name">RSI (14)</span>
                    <span class="indicator-signal buy">Buy</span>
                </div>
                <div class="indicator-value">32.4</div>
                <div class="indicator-range">
                    <span>0 (Oversold)</span>
                    <span>100 (Overbought)</span>
                </div>
                <div class="indicator-bar">
                    <div class="indicator-fill bullish w-32"></div>
                </div>
            </div>
            <div class="indicator-card">
                <div class="indicator-header">
                    <span class="indicator-name">MACD</span>
                    <span class="indicator-signal buy">Bullish</span>
                </div>
                <div class="indicator-value">+128.5</div>
                <div class="indicator-range">
                    <span>Signal: 98.2</span>
                    <span>Histogram: +30.3</span>
                </div>
                <div class="indicator-bar">
                    <div class="indicator-fill bullish w-65"></div>
                </div>
            </div>
            <div class="indicator-card">
                <div class="indicator-header">
                    <span class="indicator-name">Bollinger Bands</span>
                    <span class="indicator-signal neutral">Neutral</span>
                </div>
                <div class="indicator-value">Middle</div>
                <div class="indicator-range">
                    <span>Lower: $41,200</span>
                    <span>Upper: $44,800</span>
                </div>
                <div class="indicator-bar">
                    <div class="indicator-fill neutral w-50"></div>
                </div>
            </div>
            <div class="indicator-card">
                <div class="indicator-header">
                    <span class="indicator-name">ATR (14)</span>
                    <span class="indicator-signal sell">High Vol</span>
                </div>
                <div class="indicator-value">$1,245</div>
                <div class="indicator-range">
                    <span>Low: $400</span>
                    <span>High: $2,000</span>
                </div>
                <div class="indicator-bar">
                    <div class="indicator-fill bearish w-62"></div>
                </div>
            </div>
        </div>

        <!-- Drawdown Analysis -->
        <div class="drawdown-section">
            <div class="drawdown-chart">
                <div class="chart-header">
                    <h3><i class="fas fa-chart-line"></i> Drawdown Analysis</h3>
                    <div class="chart-controls">
                        <button class="chart-btn active">Underwater</button>
                        <button class="chart-btn">Duration</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="drawdownChart"></canvas>
                </div>
            </div>
            <div class="drawdown-stats">
                <h3 class="section-title-sm">Drawdown Statistics</h3>
                <div class="stat-item">
                    <span class="stat-label">Max Drawdown</span>
                    <span class="stat-value negative">-8.42%</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Average Drawdown</span>
                    <span class="stat-value negative">-3.21%</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Max DD Duration</span>
                    <span class="stat-value">18 days</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Avg DD Duration</span>
                    <span class="stat-value">7 days</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Recovery Factor</span>
                    <span class="stat-value positive">5.68</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Calmar Ratio</span>
                    <span class="stat-value positive">4.12</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Current Drawdown</span>
                    <span class="stat-value negative">-2.1%</span>
                </div>
            </div>
        </div>

        <!-- Trade Distribution -->
        <div class="distribution-section">
            <div class="distribution-card">
                <h3><i class="fas fa-clock"></i> Trades by Hour</h3>
                <div class="chart-container h-200">
                    <canvas id="hourlyChart"></canvas>
                </div>
            </div>
            <div class="distribution-card">
                <h3><i class="fas fa-calendar-week"></i> Trades by Day</h3>
                <div class="chart-container h-200">
                    <canvas id="dailyChart"></canvas>
                </div>
            </div>
            <div class="distribution-card">
                <h3><i class="fas fa-coins"></i> Trades by Symbol</h3>
                <div class="chart-container h-200">
                    <canvas id="symbolChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Monthly Performance Heatmap -->
        <div class="heatmap-section">
            <div class="heatmap-header">
                <h3><i class="fas fa-th"></i> Monthly Performance Heatmap</h3>
                <div class="heatmap-legend">
                    <span>Loss</span>
                    <div class="legend-gradient">
                        <div class="legend-box loss-high"></div>
                        <div class="legend-box loss-medium"></div>
                        <div class="legend-box loss-low"></div>
                        <div class="legend-box neutral"></div>
                        <div class="legend-box profit-low"></div>
                        <div class="legend-box profit-medium"></div>
                        <div class="legend-box profit-high"></div>
                    </div>
                    <span>Profit</span>
                </div>
            </div>
            <div class="heatmap-grid" id="heatmapGrid">
                <!-- Generated by JavaScript -->
            </div>
        </div>

        <!-- Strategy Comparison -->
        <div class="comparison-table">
            <table>
                <thead>
                    <tr>
                        <th>Strategy</th>
                        <th>Return</th>
                        <th>Sharpe</th>
                        <th>Max DD</th>
                        <th>Win Rate</th>
                        <th>Trades</th>
                        <th>Equity</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="strategy-name">
                                <div class="strategy-icon momentum"><i class="fas fa-rocket"></i></div>
                                <div>
                                    <strong>Momentum Pro</strong>
                                    <div class="text-subtext">BTC/USDT, ETH/USDT</div>
                                </div>
                            </div>
                        </td>
                        <td class="text-green">+24.5%</td>
                        <td>2.41</td>
                        <td class="text-red">-6.2%</td>
                        <td>72%</td>
                        <td>458</td>
                        <td><canvas class="mini-chart" id="miniChart1"></canvas></td>
                        <td><span class="indicator-signal buy">Active</span></td>
                    </tr>
                    <tr>
                        <td>
                            <div class="strategy-name">
                                <div class="strategy-icon mean-reversion"><i class="fas fa-exchange-alt"></i></div>
                                <div>
                                    <strong>Mean Reversion</strong>
                                    <div class="text-subtext">Multi-pair</div>
                                </div>
                            </div>
                        </td>
                        <td class="text-green">+18.2%</td>
                        <td>1.89</td>
                        <td class="text-red">-8.4%</td>
                        <td>65%</td>
                        <td>892</td>
                        <td><canvas class="mini-chart" id="miniChart2"></canvas></td>
                        <td><span class="indicator-signal buy">Active</span></td>
                    </tr>
                    <tr>
                        <td>
                            <div class="strategy-name">
                                <div class="strategy-icon breakout"><i class="fas fa-bolt"></i></div>
                                <div>
                                    <strong>Breakout Hunter</strong>
                                    <div class="text-subtext">SOL/USDT</div>
                                </div>
                            </div>
                        </td>
                        <td class="text-green">+31.8%</td>
                        <td>2.78</td>
                        <td class="text-red">-5.1%</td>
                        <td>58%</td>
                        <td>234</td>
                        <td><canvas class="mini-chart" id="miniChart3"></canvas></td>
                        <td><span class="indicator-signal neutral">Paused</span></td>
                    </tr>
                    <tr>
                        <td>
                            <div class="strategy-name">
                                <div class="strategy-icon grid"><i class="fas fa-th"></i></div>
                                <div>
                                    <strong>Grid Trading</strong>
                                    <div class="text-subtext">BTC/USDT</div>
                                </div>
                            </div>
                        </td>
                        <td class="text-green">+12.4%</td>
                        <td>1.52</td>
                        <td class="text-red">-3.8%</td>
                        <td>81%</td>
                        <td>1,247</td>
                        <td><canvas class="mini-chart" id="miniChart4"></canvas></td>
                        <td><span class="indicator-signal buy">Active</span></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Correlation Matrix -->
        <div class="correlation-section">
            <div class="correlation-matrix">
                <div class="matrix-header">
                    <h3><i class="fas fa-project-diagram"></i> Asset Correlation Matrix</h3>
                    <div class="chart-controls">
                        <button class="chart-btn active">1M</button>
                        <button class="chart-btn">3M</button>
                        <button class="chart-btn">1Y</button>
                    </div>
                </div>
                <!-- Row 1: Headers -->
                <div class="matrix-cell header"></div>
                <div class="matrix-cell header">BTC</div>
                <div class="matrix-cell header">ETH</div>
                <div class="matrix-cell header">SOL</div>
                <div class="matrix-cell header">XRP</div>
                <div class="matrix-cell header">DOGE</div>
                <!-- Row 2: BTC -->
                <div class="matrix-cell header">BTC</div>
                <div class="matrix-cell positive-strong">1.00</div>
                <div class="matrix-cell positive-strong">0.92</div>
                <div class="matrix-cell positive-medium">0.78</div>
                <div class="matrix-cell positive-medium">0.65</div>
                <div class="matrix-cell positive-weak">0.45</div>
                <!-- Row 3: ETH -->
                <div class="matrix-cell header">ETH</div>
                <div class="matrix-cell positive-strong">0.92</div>
                <div class="matrix-cell positive-strong">1.00</div>
                <div class="matrix-cell positive-strong">0.85</div>
                <div class="matrix-cell positive-medium">0.58</div>
                <div class="matrix-cell positive-weak">0.42</div>
                <!-- Row 4: SOL -->
                <div class="matrix-cell header">SOL</div>
                <div class="matrix-cell positive-medium">0.78</div>
                <div class="matrix-cell positive-strong">0.85</div>
                <div class="matrix-cell positive-strong">1.00</div>
                <div class="matrix-cell positive-weak">0.48</div>
                <div class="matrix-cell positive-weak">0.38</div>
                <!-- Row 5: XRP -->
                <div class="matrix-cell header">XRP</div>
                <div class="matrix-cell positive-medium">0.65</div>
                <div class="matrix-cell positive-medium">0.58</div>
                <div class="matrix-cell positive-weak">0.48</div>
                <div class="matrix-cell positive-strong">1.00</div>
                <div class="matrix-cell positive-medium">0.52</div>
                <!-- Row 6: DOGE -->
                <div class="matrix-cell header">DOGE</div>
                <div class="matrix-cell positive-weak">0.45</div>
                <div class="matrix-cell positive-weak">0.42</div>
                <div class="matrix-cell positive-weak">0.38</div>
                <div class="matrix-cell positive-medium">0.52</div>
                <div class="matrix-cell positive-strong">1.00</div>
            </div>
        </div>
    </div>

    <script>
        // Chart.js defaults
        Chart.defaults.color = '#8b949e';
        Chart.defaults.borderColor = '#30363d';

        // Equity Curve Chart
        const equityCtx = document.getElementById('equityCurveChart').getContext('2d');
        const equityData = {
            labels: Array.from({length: 30}, (_, i) => `Day ${i + 1}`),
            datasets: [{
                label: 'Portfolio Value',
                data: [10000, 10250, 10180, 10420, 10650, 10580, 10820, 11050, 10980, 11200,
                       11450, 11380, 11620, 11850, 11780, 12020, 12250, 12180, 12420, 12650,
                       12580, 12820, 13050, 12980, 13200, 13450, 13380, 13620, 13850, 14782],
                borderColor: '#58a6ff',
                backgroundColor: 'rgba(88, 166, 255, 0.1)',
                fill: true,
                tension: 0.4,
                pointRadius: 0,
                pointHoverRadius: 6
            }, {
                label: 'Benchmark (Buy & Hold)',
                data: [10000, 10100, 10050, 10200, 10350, 10300, 10450, 10600, 10550, 10700,
                       10850, 10800, 10950, 11100, 11050, 11200, 11350, 11300, 11450, 11600,
                       11550, 11700, 11850, 11800, 11950, 12100, 12050, 12200, 12350, 12500],
                borderColor: '#8b949e',
                borderDash: [5, 5],
                fill: false,
                tension: 0.4,
                pointRadius: 0
            }]
        };
        new Chart(equityCtx, {
            type: 'line',
            data: equityData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                plugins: {
                    legend: {
                        position: 'top',
                        align: 'end'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        grid: {
                            color: 'rgba(48, 54, 61, 0.5)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

        // Returns Distribution Chart
        const returnsCtx = document.getElementById('returnsDistChart').getContext('2d');
        new Chart(returnsCtx, {
            type: 'bar',
            data: {
                labels: ['<-5%', '-5% to -3%', '-3% to -1%', '-1% to 0%', '0% to 1%', '1% to 3%', '3% to 5%', '>5%'],
                datasets: [{
                    label: 'Trade Count',
                    data: [12, 45, 128, 234, 312, 287, 156, 42],
                    backgroundColor: [
                        'rgba(248, 81, 73, 0.8)',
                        'rgba(248, 81, 73, 0.6)',
                        'rgba(248, 81, 73, 0.4)',
                        'rgba(248, 81, 73, 0.2)',
                        'rgba(63, 185, 80, 0.2)',
                        'rgba(63, 185, 80, 0.4)',
                        'rgba(63, 185, 80, 0.6)',
                        'rgba(63, 185, 80, 0.8)'
                    ],
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(48, 54, 61, 0.5)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

        // Drawdown Chart
        const ddCtx = document.getElementById('drawdownChart').getContext('2d');
        const drawdownData = [0, -0.5, -1.2, -0.8, -0.3, -1.5, -2.1, -1.8, -0.9, -0.4,
                              -2.5, -3.2, -4.1, -5.2, -6.8, -8.4, -7.2, -5.8, -4.2, -3.1,
                              -2.4, -1.8, -1.2, -0.6, -1.4, -2.1, -1.5, -0.8, -0.3, -2.1];
        new Chart(ddCtx, {
            type: 'line',
            data: {
                labels: Array.from({length: 30}, (_, i) => `Day ${i + 1}`),
                datasets: [{
                    label: 'Drawdown %',
                    data: drawdownData,
                    borderColor: '#f85149',
                    backgroundColor: 'rgba(248, 81, 73, 0.2)',
                    fill: true,
                    tension: 0.4,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        max: 0,
                        grid: {
                            color: 'rgba(48, 54, 61, 0.5)'
                        },
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

        // Hourly Distribution Chart
        const hourlyCtx = document.getElementById('hourlyChart').getContext('2d');
        new Chart(hourlyCtx, {
            type: 'bar',
            data: {
                labels: ['0', '2', '4', '6', '8', '10', '12', '14', '16', '18', '20', '22'],
                datasets: [{
                    label: 'Trades',
                    data: [45, 32, 28, 52, 78, 125, 156, 142, 168, 134, 89, 56],
                    backgroundColor: 'rgba(88, 166, 255, 0.6)',
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { display: false },
                    x: { grid: { display: false } }
                }
            }
        });

        // Daily Distribution Chart
        const dailyCtx = document.getElementById('dailyChart').getContext('2d');
        new Chart(dailyCtx, {
            type: 'bar',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'P&L',
                    data: [2450, 1820, 3120, -580, 1950, 890, 1240],
                    backgroundColor: function(context) {
                        return context.raw >= 0 ? 'rgba(63, 185, 80, 0.6)' : 'rgba(248, 81, 73, 0.6)';
                    },
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { display: false },
                    x: { grid: { display: false } }
                }
            }
        });

        // Symbol Distribution Chart
        const symbolCtx = document.getElementById('symbolChart').getContext('2d');
        new Chart(symbolCtx, {
            type: 'doughnut',
            data: {
                labels: ['BTC', 'ETH', 'SOL', 'XRP', 'Others'],
                datasets: [{
                    data: [35, 28, 18, 12, 7],
                    backgroundColor: [
                        '#f7931a',
                        '#627eea',
                        '#00ffa3',
                        '#23292f',
                        '#8b949e'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            boxWidth: 12,
                            padding: 8
                        }
                    }
                },
                cutout: '60%'
            }
        });

        // Mini Charts for Strategy Comparison
        function createMiniChart(canvasId, data, color) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data,
                    datasets: [{
                        data: data,
                        borderColor: color,
                        borderWidth: 2,
                        fill: false,
                        tension: 0.4,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    }
                }
            });
        }

        createMiniChart('miniChart1', [10, 12, 11, 14, 13, 16, 18, 17, 20, 22, 24], '#58a6ff');
        createMiniChart('miniChart2', [10, 11, 10, 12, 11, 13, 12, 14, 15, 17, 18], '#a371f7');
        createMiniChart('miniChart3', [10, 13, 12, 15, 18, 17, 20, 19, 22, 28, 31], '#3fb950');
        createMiniChart('miniChart4', [10, 10, 11, 11, 11, 12, 12, 11, 12, 12, 12], '#f0883e');

        // Generate Heatmap
        function generateHeatmap() {
            const grid = document.getElementById('heatmapGrid');
            const months = ['', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const years = ['2024', '2025'];
            
            const performanceData = {
                '2024': [4.2, -1.5, 2.8, 5.1, -2.3, 3.7, 6.2, -0.8, 4.5, 7.1, 3.2, 5.8],
                '2025': [6.4, 4.8, -1.2, 3.5, 2.9, 5.2, 0, 0, 0, 0, 0, 0]
            };

            // Header row
            months.forEach(month => {
                const cell = document.createElement('div');
                cell.className = 'heatmap-label';
                cell.textContent = month;
                cell.style.justifyContent = month ? 'center' : 'flex-end';
                cell.style.paddingRight = month ? '0' : '8px';
                grid.appendChild(cell);
            });

            // Data rows
            years.forEach(year => {
                const yearLabel = document.createElement('div');
                yearLabel.className = 'heatmap-label';
                yearLabel.textContent = year;
                yearLabel.style.justifyContent = 'flex-end';
                yearLabel.style.paddingRight = '8px';
                grid.appendChild(yearLabel);

                performanceData[year].forEach((value, idx) => {
                    const cell = document.createElement('div');
                    cell.className = 'heatmap-cell';
                    
                    if (value === 0) {
                        cell.classList.add('neutral');
                    } else if (value > 5) {
                        cell.classList.add('profit-high');
                        cell.textContent = `+${value}%`;
                    } else if (value > 2) {
                        cell.classList.add('profit-medium');
                        cell.textContent = `+${value}%`;
                    } else if (value > 0) {
                        cell.classList.add('profit-low');
                        cell.textContent = `+${value}%`;
                    } else if (value > -2) {
                        cell.classList.add('loss-low');
                        cell.textContent = `${value}%`;
                    } else if (value > -5) {
                        cell.classList.add('loss-medium');
                        cell.textContent = `${value}%`;
                    } else {
                        cell.classList.add('loss-high');
                        cell.textContent = `${value}%`;
                    }
                    
                    cell.title = `${months[idx + 1]} ${year}: ${value > 0 ? '+' : ''}${value}%`;
                    grid.appendChild(cell);
                });
            });
        }

        generateHeatmap();

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => {
                    t.classList.remove('active');
                    t.setAttribute('aria-selected', 'false');
                });
                this.classList.add('active');
                this.setAttribute('aria-selected', 'true');
            });
        });

        // Chart period buttons
        document.querySelectorAll('.chart-controls').forEach(controls => {
            controls.querySelectorAll('.chart-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    controls.querySelectorAll('.chart-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'r' && !e.ctrlKey && !e.metaKey) {
                // Refresh data
                console.log('Refreshing data...');
            }
            if (e.key === 'Escape') {
                // Close any open modals
            }
        });
    </script>
    <script type="module" src="/frontend/js/pages/analytics_advanced.js"></script>
</body>
</html>
